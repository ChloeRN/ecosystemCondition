[{"path":"index.html","id":"about","chapter":"About","heading":"About","text":"site may view nitty gritty details certain indicators ecosystem condition Norway calculated.web page made document work related R&D project develop indicators ecosystem condition three main ecosystems Norway: wetlands, open areas forest line, semi-natural land. indicators yet used real assessments, may represent unfinished work pending future data availability. addition, may chose also present analyses documenting indicators used existing assessments ecosystem condition.","code":""},{"path":"index.html","id":"community-review","chapter":"About","heading":"Community review","text":"want work transparent credible. Therefor encourage types feedback analyses indicators ecological condition can read web site. submit comments, please github repository open new issue answer .","code":""},{"path":"index.html","id":"author-guidelines","chapter":"About","heading":"Author guidelines","text":"project uses type standardised reporting reproducible workflows (typically code) calculating indicator presented separate webpages within shared website. website built GitHub repo using seperate RMarkdown files chapter. files must English. process authoring sharing/distributing Rmarkdown-files explained .highly encouraged indicators delivered georeferenced maps, hereafter called indicator maps, simple tables. common structure indicator maps follow. indicator maps can vector formats raster formats. vector data, .Rdata .rds files can used, example shape files allow field names (.e. column names) long ones use. georeferenced data use EPSG:25833 - ETRS89 / UTM zone 33N.Indicator maps highest possible spatial resolution possible weighing need spatial representativity. example, may need aggregate x number data points get average stable representative given region. need spatially aggregate indicator maps , example produce national estimate.indicator values, reference values ect mapped following columns (vector data) bands (raster data):v_YYYY variable value (.e. un-scaled raw indicator values) year YYYY.sd_YYYY standard deviation associated v_YYYY. measures uncertainty currently supported.referance_high reference value, .e. value variable v reference conditions. value vary years.referance_low lower limit reference value, .e. worst possible value variable v. value vary years. missing, value assumed zero.thr threshold value defining good condition variable v. missing, value default 0.6.i_YYYY indicator value year YYYY. value depends values, also scaling function (.e. linear, exponential, two-sided, ect.). scaling function needs presented documentation.rest workflow follows.Obtain go ahead signal coordination group make sure free start workRead template.Rmd file. Make copy store , (root) folder DRAFT_myIndicator.Rmd. (example, see DRAFT_breareal.Rmd). Finish documentation analyses .\ncan load data internal NINA servers, web hosts, store smaller data set data.\ndata folder also contains supporting data sets may want use, delineation five regions used ecosystem assessment (data/regions.shp), outline Norway (outlineOfNorway_EPSG25833.shp).\npreview rmarkdown file html R, type rmarkdown::render('DRAFT_myIndicator.Rmd', output_format = \"html_document\", output_dir = \"temp\") console (knitr shortcuts don’t work expected inside bookdown projects).\nfilling template.Rmd file work, try change headers much.\nFinal result analyses written indicators folder. preferred output georeferenced data (rasters shape files), placed indators/indicatorMaps. Non-georeferenced data, like data tables, can stored indicators.\ncan load data internal NINA servers, web hosts, store smaller data set data.\ndata folder also contains supporting data sets may want use, delineation five regions used ecosystem assessment (data/regions.shp), outline Norway (outlineOfNorway_EPSG25833.shp).preview rmarkdown file html R, type rmarkdown::render('DRAFT_myIndicator.Rmd', output_format = \"html_document\", output_dir = \"temp\") console (knitr shortcuts don’t work expected inside bookdown projects).filling template.Rmd file work, try change headers much.Final result analyses written indicators folder. preferred output georeferenced data (rasters shape files), placed indators/indicatorMaps. Non-georeferenced data, like data tables, can stored indicators.Make pull request main GitHub repository submit file. comfortable using GitHub, contac Anders rrange sending files via email.Anders someone else project wil conduct rapid code review, making sure code reproducible, interpretable renders locally R Studio server.approved, reviewer make copy DRAFT_ file, removing DRAFT_ part name, well YML header, well updating rmd_files part _bookdown.yml. (example file, see breareal.Rmd.)update web site (web site), admin user needs pull repo R Studio server, compile book (Ctr+Shift+B), commit push main. html version book docs folder.","code":""},{"path":"overview-of-indicators.html","id":"overview-of-indicators","chapter":"Overview of indicators","heading":"Overview of indicators","text":"Lacking content\nidea page give quick overview available indicators, possibly present Norwegian fact sheets . now page just example look like.","code":""},{"path":"overview-of-indicators.html","id":"areal-av-isbreer-glacier-area","chapter":"Overview of indicators","heading":"Areal av isbreer / Glacier area","text":"indicator reflects relative loss glacial area tha last climatic normal persion today.\nTable 0.1: Fakatark tilstandindikatoren Areal av isbreer\n","code":""},{"path":"overview-of-indicators.html","id":"indicator-x","chapter":"Overview of indicators","heading":"Indicator X","text":"indicator …","code":""},{"path":"areal-av-isbreer.html","id":"areal-av-isbreer","chapter":"1 Areal av isbreer","heading":"1 Areal av isbreer","text":"Author date:\nAnders Kolstad","code":"#> [1] \"2022-10-11\""},{"path":"areal-av-isbreer.html","id":"introduction","chapter":"1 Areal av isbreer","heading":"1.1 Introduction","text":"indicator describes relative change glacial extent fire regions Norway. slightly different indicator used alpine assessment.","code":""},{"path":"areal-av-isbreer.html","id":"about-the-underlying-data","chapter":"1 Areal av isbreer","heading":"1.2 About the underlying data","text":"indicator uses maps glacier extent ( breatlas ) 2018-2019 compares similar map 1947-1985. maps owned NVE (Norsk vassdrags og energidirektorat). new map based Sentinel images, old map digitised version N50 maps, additional areal photo interpretation top.","code":""},{"path":"areal-av-isbreer.html","id":"representativity-in-time-and-space","chapter":"1 Areal av isbreer","heading":"1.2.1 Representativity in time and space","text":"data set (map) covers entire Norwegian mainland. two time steps, expect changes glacial extent relatively linear consistent time.\nolder map may underestimated glacial extent due better chance smaller snow ice patches captured Sentinel contra aerial photo interpretations.","code":""},{"path":"areal-av-isbreer.html","id":"original-units","chapter":"1 Areal av isbreer","heading":"1.2.2 Original units","text":"Area units (e.g. km2)","code":""},{"path":"areal-av-isbreer.html","id":"temporal-coverage","chapter":"1 Areal av isbreer","heading":"1.2.3 Temporal coverage","text":"1947-2019","code":""},{"path":"areal-av-isbreer.html","id":"aditional-comments-about-the-dataset","chapter":"1 Areal av isbreer","heading":"1.2.4 Aditional comments about the dataset","text":"None","code":""},{"path":"areal-av-isbreer.html","id":"ecosystem-characteristic","chapter":"1 Areal av isbreer","heading":"1.3 Ecosystem characteristic","text":"","code":""},{"path":"areal-av-isbreer.html","id":"norwegian-standard","chapter":"1 Areal av isbreer","heading":"1.3.1 Norwegian standard","text":"indicator initially assigned Abiotiske forhold characteristic, now considered Landskapsøkologiske mønstre. initial justificaton glacial melting influence water availability downstream. Now put weight glaciers just resevoirs ice water, habitat, presence abundance specific habitat can though aspect landscape state.","code":""},{"path":"areal-av-isbreer.html","id":"seea-ect","chapter":"1 Areal av isbreer","heading":"1.3.2 SEEA ECT","text":"indicator similarly assiged SEEA ECT class C1 Landscape characteristics.","code":""},{"path":"areal-av-isbreer.html","id":"collinearities-with-other-indicators","chapter":"1 Areal av isbreer","heading":"1.4 Collinearities with other indicators","text":"None known.","code":""},{"path":"areal-av-isbreer.html","id":"reference-state-and-values","chapter":"1 Areal av isbreer","heading":"1.5 Reference state and values","text":"","code":""},{"path":"areal-av-isbreer.html","id":"reference-state","chapter":"1 Areal av isbreer","heading":"1.5.1 Reference state","text":"indicator uses reference state indicators developed similar projects, defined Nybø et al (2017): Fagsystem fastsetting av god økologisk tilstand. glacial extent primarily, solely, dependent climate, case actual data climatic reference period previous normal period 1961-1990.","code":""},{"path":"areal-av-isbreer.html","id":"reference-values-thresholds-for-defining-good-ecological-condition-minimum-andor-maximum-values","chapter":"1 Areal av isbreer","heading":"1.5.2 Reference values, thresholds for defining good ecological condition, minimum and/or maximum values","text":"reference value zero change glacial extent time. threshold defining good ecological condition set 40% reduction glacial extent, default solution. normalization follows linear model, although sigmoidal weibull function might appropriate.minimum value set zero.","code":""},{"path":"areal-av-isbreer.html","id":"uncertainties","chapter":"1 Areal av isbreer","heading":"1.6 Uncertainties","text":"add 3% error side estimates, reported glacier maps NVE.","code":""},{"path":"areal-av-isbreer.html","id":"references","chapter":"1 Areal av isbreer","heading":"1.7 References","text":"Andreassen, L.M., & Winsvold, S.H. (eds.). 2012. Inventory Norwegian glaciers. NVE Rapport 38, Norges Vassdrags- og energidirektorat, 236 sAndreassen, L.M., & Winsvold, S.H. (eds.). 2012. Inventory Norwegian glaciers. NVE Rapport 38, Norges Vassdrags- og energidirektorat, 236 sAndreassen, L.M., Elvehøy, H., Kjøllmoen, B. & Belart, J.M.C. 2020. Glacier change Norway since 1960s – overview mass balance, area, length surface elevation changes. Journal Glaciology 66: 313–328Andreassen, L.M., Elvehøy, H., Kjøllmoen, B. & Belart, J.M.C. 2020. Glacier change Norway since 1960s – overview mass balance, area, length surface elevation changes. Journal Glaciology 66: 313–328Andreassen, L.M., Nagy, T., Kjøllmoen, B. & Leigh, J.R. 2022. Sentinel-2 based inventory Norway’s glaciers ice-marginal lakes 2018/2019. Journal Glaciology (review)Andreassen, L.M., Nagy, T., Kjøllmoen, B. & Leigh, J.R. 2022. Sentinel-2 based inventory Norway’s glaciers ice-marginal lakes 2018/2019. Journal Glaciology (review)Winsvold, S.H., Andreassen, L.M. & Kienholz, C.. 2014. Glacier area length changes Norway repeat inventories. Cryosphere 8: 1885-1903Winsvold, S.H., Andreassen, L.M. & Kienholz, C.. 2014. Glacier area length changes Norway repeat inventories. Cryosphere 8: 1885-1903","code":""},{"path":"areal-av-isbreer.html","id":"analyses","chapter":"1 Areal av isbreer","heading":"1.8 Analyses","text":"","code":""},{"path":"areal-av-isbreer.html","id":"importing-the-data-sets","chapter":"1 Areal av isbreer","heading":"1.8.1 Importing the data sets","text":"four data sets:glacial atlasn50 (old glacial atlas)regional delineation Norway (fire regions)outline mainland NorwayWe assuming glaciers found mountins, se need mask glacial atlas data using ecosystem delineation map.","code":""},{"path":"areal-av-isbreer.html","id":"glacial-atlas","chapter":"1 Areal av isbreer","heading":"1.8.1.1 Glacial atlas","text":"new glacial atlas 2018 2019 based Sentinell (ref. Liss Marie Andreassen, NVE)maps made project need CRS: EPSG:25833 - ETRS89 / UTM zone 33N.\none UTM 33N ETRS89, even defined old Proj.4 way.6915 polygons. Let’s calculate area polygons study distribution size classes.polygons small, couple big ones. largest polygon 50 km2, note polygons somewhat arbitrarily split.","code":"\n\n# server path\nbreatlas_path <- '/data/P-Prosjekter/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/breatlas_2018_2019/Breatlas_20182019_temp20210922_lma.shp'\n\n# local path \n#breatlas_path <- 'P:/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/breatlas_2018_2019/Breatlas_20182019_temp20210922_lma.shp'\n\n\nbreatlas <- sf::st_read(breatlas_path)\n#> Reading layer `Breatlas_20182019_temp20210922_lma' from data source `/data/P-Prosjekter/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/breatlas_2018_2019/Breatlas_20182019_temp20210922_lma.shp' \n#>   using driver `ESRI Shapefile'\n#> Simple feature collection with 6915 features and 27 fields (with 4 geometries empty)\n#> Geometry type: MULTIPOLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: -9874.591 ymin: 6624398 xmax: 810132 ymax: 7836994\n#> Projected CRS: ETRS89 / UTM zone 33N\nbreatlas$area <- st_area(breatlas)\npar(mfrow=c(1,2))\nhist(breatlas$area)\nplot(breatlas$area)"},{"path":"areal-av-isbreer.html","id":"map-of-norway","chapter":"1 Areal av isbreer","heading":"1.8.1.2 Map of Norway","text":"map stored GitHub repository indicators/data/.","code":"\nnor <- sf::read_sf(\"data/outlineOfNorway_EPSG25833.shp\")\n\nplot(nor$geometry, axes=T, main = \"Breatlas 2018-2019\")\n  plot(breatlas$geometry, add=T, border = \"blue\")"},{"path":"areal-av-isbreer.html","id":"n50","chapter":"1 Areal av isbreer","heading":"1.8.1.3 N50","text":"old glacial extent map. Import transform , .Let’s now plot top .red areas map far right ice retreated selected glacier west coast.\nNow need devide map regions compare area n50 new glacial extent map breatlas.","code":"\n\n# server path\nn50_path <- '/data/P-Prosjekter/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/n50/cryoclim_GAO_NO_1952_1985_UTM_33N.shp'\n\n# local path\n#n50_path <- 'P:/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/n50/cryoclim_GAO_NO_1952_1985_UTM_33N.shp'\n\nn50 <- sf::st_read(n50_path)%>%\n  st_transform(crs = crs(breatlas))\n#> Reading layer `cryoclim_GAO_NO_1952_1985_UTM_33N' from data source `/data/P-Prosjekter/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/n50/cryoclim_GAO_NO_1952_1985_UTM_33N.shp' \n#>   using driver `ESRI Shapefile'\n#> Simple feature collection with 7141 features and 30 fields\n#> Geometry type: POLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: -7278.562 ymin: 6623024 xmax: 812207.8 ymax: 7841654\n#> Projected CRS: WGS 84 / UTM zone 33N\nplot(nor$geometry, axes=T, main = \"n50 - 1952-1985\")\n  plot(n50$geometry, add=T, border = \"red\")\n\n# define some boundary boxes for zooming in on specific regions\nmyExt <- raster::extent(c(0, 100000, 6840000, 6900000))\nmyExt2 <- raster::extent(c(5000, 10000, 6880000, 6885000))\n\n# Prepare plotting device with one row, three columns\npar(mfrow=c(1,3))\n\n# Create three maps, each zooming in a bit further.\nplot(nor$geometry, axes=T)\n    plot(n50$geometry,  border = \"orange\", col = scales::alpha(\"orange\", 1), add=T)\n    plot(myExt, add=T, lwd=2)\n\nplot(nor$geometry, xlim=c(0, 100000),\n          ylim=c(6840000, 6900000),\n          axes=T)\n    plot(n50$geometry, add=T, col = \"grey\")\n    plot(myExt2, add=T, lwd=3, col=\"orange\")\n\n# for this last map I plot the old extent in red and the new as grey on top. The red areas still visible will be areas where the glaciers have retreated.        \nplot(nor$geometry, xlim=c(5000, 10000),\n          ylim=c(6880000, 6885000),\n     axes=T)\n    plot(n50$geometry, add=T, col = \"red\")\n    plot(breatlas$geometry, add=T, col = \"grey\")"},{"path":"areal-av-isbreer.html","id":"regions","chapter":"1 Areal av isbreer","heading":"1.8.1.4 Regions","text":"Importing shape file regional delineation.Let’s plot make sure correct.Get region namesThese odd. Let fix Norwegian letters manually.going need fix problem glacier polygons crossing .68 polygons valid.\nLet’s look first four reasons .convinient function fix .Let plot new, fixed map top old see match. give new valid map blue transparent colour, old map yellow transparent colour.seems worked.\nNotice also larger polygons somewhat arbitrarely divided several adjoining polygons. new map, old n50 map.Delete invalid data set.","code":"\nreg <- st_read(\"data/regions.shp\")\n#> Reading layer `regions' from data source \n#>   `/data/Egenutvikling/41001581_egenutvikling_anders_kolstad/github/ecosystemCondition/data/regions.shp' \n#>   using driver `ESRI Shapefile'\n#> Simple feature collection with 5 features and 2 fields\n#> Geometry type: POLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: -99551.21 ymin: 6426048 xmax: 1121941 ymax: 7962744\n#> Projected CRS: ETRS89 / UTM zone 33N\nst_crs(reg)\n#> Coordinate Reference System:\n#>   User input: ETRS89 / UTM zone 33N \n#>   wkt:\n#> PROJCRS[\"ETRS89 / UTM zone 33N\",\n#>     BASEGEOGCRS[\"ETRS89\",\n#>         DATUM[\"European Terrestrial Reference System 1989\",\n#>             ELLIPSOID[\"GRS 1980\",6378137,298.257222101,\n#>                 LENGTHUNIT[\"metre\",1]]],\n#>         PRIMEM[\"Greenwich\",0,\n#>             ANGLEUNIT[\"degree\",0.0174532925199433]],\n#>         ID[\"EPSG\",4258]],\n#>     CONVERSION[\"UTM zone 33N\",\n#>         METHOD[\"Transverse Mercator\",\n#>             ID[\"EPSG\",9807]],\n#>         PARAMETER[\"Latitude of natural origin\",0,\n#>             ANGLEUNIT[\"degree\",0.0174532925199433],\n#>             ID[\"EPSG\",8801]],\n#>         PARAMETER[\"Longitude of natural origin\",15,\n#>             ANGLEUNIT[\"degree\",0.0174532925199433],\n#>             ID[\"EPSG\",8802]],\n#>         PARAMETER[\"Scale factor at natural origin\",0.9996,\n#>             SCALEUNIT[\"unity\",1],\n#>             ID[\"EPSG\",8805]],\n#>         PARAMETER[\"False easting\",500000,\n#>             LENGTHUNIT[\"metre\",1],\n#>             ID[\"EPSG\",8806]],\n#>         PARAMETER[\"False northing\",0,\n#>             LENGTHUNIT[\"metre\",1],\n#>             ID[\"EPSG\",8807]]],\n#>     CS[Cartesian,2],\n#>         AXIS[\"(E)\",east,\n#>             ORDER[1],\n#>             LENGTHUNIT[\"metre\",1]],\n#>         AXIS[\"(N)\",north,\n#>             ORDER[2],\n#>             LENGTHUNIT[\"metre\",1]],\n#>     USAGE[\n#>         SCOPE[\"unknown\"],\n#>         AREA[\"Europe - 12°E to 18°E and ETRS89 by country\"],\n#>         BBOX[46.4,12,84.01,18.01]],\n#>     ID[\"EPSG\",25833]]\nplot(nor$geometry, axes=T)\n  plot(reg$geometry, add=T, border = \"black\", \n       col = scales::alpha(c(\"blue\", \n                             \"red\", \n                             \"green\",\n                             \"yellow\",\n                             \"brown\"), .2))\nunique(reg$region)\n#> [1] \"Nord-Norge\"      \"Midt-Norge\"      \"Ã\\u0098stlandet\"\n#> [4] \"Vestlandet\"      \"SÃ¸rlandet\"\nreg$region[reg$region==\"Ã\\u0098stlandet\"] <- \"Østlandet\"\nreg$region[reg$region==\"SÃ¸rlandet\"] <- \"Sørlandet\"\ntable(st_is_valid(breatlas))\n#> \n#> FALSE  TRUE \n#>    68  6847\nunique(st_is_valid(breatlas, reason=T))[1:5]\n#> [1] \"Valid Geometry\"                                       \n#> [2] \"Ring Self-intersection[100236.4931 6912507.5864]\"     \n#> [3] \"Ring Self-intersection[92500.2095999997 6900940.8003]\"\n#> [4] \"Ring Self-intersection[91965.6612 6883260.4912]\"      \n#> [5] \"Ring Self-intersection[120595.9254 6853573.4955]\"\n# requires lwgeom\nbreatlas2 <- st_make_valid(breatlas)\ntable(st_is_valid(breatlas2))\n#> \n#> TRUE \n#> 6915\n\n# same result:\n#breatlas2 <- st_buffer(breatlas, 0.0)\n#table(st_is_valid(breatlas2))\nplot(nor$geometry, xlim=c(5000, 10000),\n          ylim=c(6880000, 6885000),\n     axes=T)\n    plot(breatlas2$geometry, add=T, col = scales::alpha(\"blue\",0.5))\n    plot(breatlas$geometry, add=T, col = scales::alpha(\"yellow\",0.5))\nbreatlas <- breatlas2\nrm(breatlas2)"},{"path":"areal-av-isbreer.html","id":"glacial-area-per-region","chapter":"1 Areal av isbreer","heading":"1.8.2 Glacial area per region","text":"","code":""},{"path":"areal-av-isbreer.html","id":"contemporary-area","chapter":"1 Areal av isbreer","heading":"1.8.2.1 Contemporary area","text":"one method getting glacial area region.Checking happens polygons span regions. Central Norway red western Norway green. 50% transparency means get third colour overlap.worked fine.Calculating area polygonsSouthern Norway <1km2 glaciers 2018-2019.","code":"\n# This intersection operation is a bit heavy, so I do it once and store it locally so that I can import it again quickly. \n#brealtas_reg <- st_intersection(breatlas, reg)\n#saveRDS(brealtas_reg, \"indicators/data/brealtas_reg_helperfile.rds\")\n\n# Importing what I create above\nbrealtas_reg <- readRDS(\"data/brealtas_reg_helperfile.rds\")\nplot(brealtas_reg$geometry[brealtas_reg$region==\"Midt-Norge\"], \n    col = scales::alpha(\"red\",0.5), border=NA, axes=T, \n     ylim=c(6900000, 6905000),\n     xlim=c(85000, 100000))\nplot(brealtas_reg$geometry[brealtas_reg$region==\"Vestlandet\"], \n     col = scales::alpha(\"green\",0.5), border=NA, add=T)\n  plot(nor$geometry, add=T)\n#Calculating the area of the polygons\nbrealtas_reg$area_crop <- st_area(brealtas_reg)\n\n# summing the area for each region\nbretabell <- tapply(\n       brealtas_reg$area_crop,\n       brealtas_reg$region,\n       FUN = sum)\n\n# converting from m2 to km2\nbretabell <- bretabell/1000000\n\n# plotting\nbarplot(\n  bretabell,\n  ylab=\"Breareal (km2)\"\n)"},{"path":"areal-av-isbreer.html","id":"same-for-n50","chapter":"1 Areal av isbreer","heading":"1.8.2.2 Same for N50","text":"Thats good.\nNow plot reference values (n50) contemporary data together.figure , glacial area reference periond light grey todays area dark grey. height light grey bar depicts reduction glacial area.little glaicers southern Norway reference period, 4 km2. condition poor! ’m entirely sure representative. alternative set NA, think - one argue glaciers important central alpine ecosystems south.","code":"\nn50x <- st_make_valid(n50)\n#n50_reg <- st_intersection(n50x, reg)\n#saveRDS(n50_reg, \"indicators/data/n50_helperfile.rds\")\nn50_reg <- readRDS(\"data/n50_helperfile.rds\")\nplot(n50_reg$geometry[n50_reg$region==\"Midt-Norge\"], \n    col = scales::alpha(\"red\",0.5), border=NA, axes=T, \n     ylim=c(6900000, 6905000),\n     xlim=c(85000, 100000))\nplot(n50_reg$geometry[n50_reg$region==\"Vestlandet\"], \n     col = scales::alpha(\"green\",0.5), border=NA, add=T)\n  plot(nor$geometry, add=T)\nn50_reg$area_crop <- st_area(n50_reg)\n\nn50tabell <- tapply(\n       n50_reg$area_crop,\n       n50_reg$region,\n       FUN = sum)\nn50tabell <- n50tabell/1000000 \n\n\nbarplot(\n  n50tabell,\n  ylab=\"Breareal (km2)\",\n  col=\"grey\"\n)\nbarplot(\n  bretabell,\n  ylab=\"Breareal (km2)\",\n  add=T,\n  col=\"grey30\"\n)"},{"path":"areal-av-isbreer.html","id":"scaled-indicator-values","chapter":"1 Areal av isbreer","heading":"1.8.3 Scaled indicator values","text":"Making table indicator values.Scaling clipping regions outline NorwayPlotting static map scaled indicator valuesCalculating total change glacier extentWe’ve lost 30% glacial area time.","code":"\nmyTbl <- tibble(region           = names(bretabell),\n                indikator        = bretabell,\n                referanseverdi   = n50tabell)\nmyTbl$skalert_indikator <- myTbl$indikator/myTbl$referanseverdi\n\nknitr::kable(myTbl)\n# paste the scaled indicato values into the shape file with the regions, using the match function to make sure the align correctly\nreg$skalert_indikator <- myTbl$skalert_indikator[match(reg$region, myTbl$region)]\n\n# cutting away the marine areas\nreg_clipped <- st_intersection(reg, nor)\n#> Warning: attribute variables are assumed to be spatially\n#> constant throughout all geometries\n# round of to 2 decimals\nreg_clipped$skalert_indikator_r <- round(reg_clipped$skalert_indikator, 2)\ntmap_mode(\"plot\") # mode 'view' takes a lot longer to render, but looks better\n#> tmap mode set to plotting\ntm_shape(reg_clipped) + \n  tm_polygons(col=\"skalert_indikator\", \n              border.col = \"white\")+\n  tm_text(\"skalert_indikator_r\", size=1.5)+\n  tm_shape(nor)+\n  tm_polygons(alpha = 0,border.col = \"black\")\n# removing the value for souther norway\nreg_clipped$skalert_indikator[reg_clipped$region==\"Sørlandet\"] <- NA\nsum(bretabell)/sum(n50tabell)\n#> [1] 0.7003536"},{"path":"areal-av-isbreer.html","id":"uncertainty","chapter":"1 Areal av isbreer","heading":"1.8.4 Uncertainty","text":"NVE reports 3% uncertainty method. interpret +- 3% represent 99.9%CI estimate (ca 2 SD).\noriginal indicator re-sampled indicator value 10000 times , 0.015sd, get distribution indicator values. time settle reporting sd single value .","code":""},{"path":"areal-av-isbreer.html","id":"prepare-export","chapter":"1 Areal av isbreer","heading":"1.9 Prepare export","text":"Now can prepare final exported data file. shape file raw scaled indicator values, reference reference values, uncertainties.names columns standardised (region, v_YYYY, sd_YYYY, i_YYYY, reference).","code":"\nnames(reg_clipped)\n#> [1] \"id\"                  \"region\"             \n#> [3] \"skalert_indikator\"   \"GID_0\"              \n#> [5] \"NAME_0\"              \"geometry\"           \n#> [7] \"skalert_indikator_r\"\n# paste the raw variable estimates\nreg_clipped$v_2019 <- myTbl$indikator[match(reg_clipped$region, myTbl$region)]              \n\n# paste the reference values\nreg_clipped$reference <- myTbl$referanseverdi[match(reg_clipped$region, myTbl$region)]      \n\n# add 3% (one-sided) errors (SD=1.5% so that 1.95SD equals about 3%). \nreg_clipped$sd_2019 <- reg_clipped$v_2019*0.015\n        \n# subset the shape file to include only the columns of interest, and rename the column with the scaled indicator values, assigning the value to year 2019.\nexp <- dplyr::select(reg_clipped,\n                     region,\n                     v_2019,\n                     sd_2019,\n                     reference,\n                     i_2019 = skalert_indikator,\n                     geometry)"},{"path":"areal-av-isbreer.html","id":"eksport-shape-file-final-product","chapter":"1 Areal av isbreer","heading":"1.9.1 Eksport shape file (final product)","text":"","code":"\nsf::st_write(exp, \"indicators/indicatorMaps/breareal.shp\")\nknitr::kable(exp[,1:5])"},{"path":"test1.html","id":"test1","chapter":"2 This is an indicator","heading":"2 This is an indicator","text":"","code":"\nplot(rnorm(10,10,10))"},{"path":"naturtype1.html","id":"naturtype1","chapter":"3 Nature types - Part 1","heading":"3 Nature types - Part 1","text":"application naturetype dataset - Part 1 - Data exploration cleaningAuthor: Anders L. KolstadDate: 2022-10-11Here investigate specific data set, Naturtyper - Miljødirektoratets instruks try evaluate usability designing indicators ecosystem condition. involves assessing spatial temporal representation, well conseptual alignment Norwegian system ecosystem condition assessments.precision field mapping assess . assume , even considerable, sampling error, inherent field data.first part analysis simply get overview data clean , making ready part 2.","code":""},{"path":"naturtype1.html","id":"import-data-and-general-summary-statistics","chapter":"3 Nature types - Part 1","heading":"3.1 Import data and general summary statistics","text":"Fix non-valid polygonsThe dataset 95k polygons, 36 variables:therefore takes little minute render plot, code :","code":"\n# local path\n#path <- \"data/R:/GeoSpatialData/Habitats_biotopes/Norway_Miljodirektoratet_Naturtyper_nin/Original/Natur_Naturtyper_NiN_norge_med_svalbard_25833.gdb\"\n# server path\n#path <- \"/data/P-Prosjekter/41201785_okologisk_tilstand_2022_2023/data/Natur_Naturtyper_NiN_norge_med_svalbard_25833.gdb\"\n\n# temporary path \npath <- \"/data/Egenutvikling/41001581_egenutvikling_anders_kolstad/data/Natur_Naturtyper_NiN_norge_med_svalbard_25833.gdb\"\ndat <- sf::st_read(dsn = path)\ndat <- sf::st_make_valid(dat)\ndim(dat)\n#> [1] 95469    36\nnor <- sf::read_sf(\"data/outlineOfNorway_EPSG25833.shp\")\ntmap_mode(\"view\")\ntm_shape(dat) + \n  tm_polygons(col=\"tilstand\")+\n  tm_shape(nor)+\n  tm_polygons(alpha = 0,border.col = \"black\")"},{"path":"naturtype1.html","id":"area","chapter":"3 Nature types - Part 1","heading":"3.2 Area","text":"Calculating area polygon/localityThe smallest polygons 20 m2, biggest 8.5 km2.Sum mapped area divided Norwegian mainland area:0.5% Norway mapped (bigger area surveyed, small fraction delineated). therefore essential 0.5% representative.","code":"\ndat$area <- sf::st_area(dat)\nsummary(dat$area)\n#>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#>      20     722    2891   17677    9026 8532702\nnor <- sf::read_sf(\"data/outlineOfNorway_EPSG25833.shp\")\nsum(dat$area)/sf::st_area(nor)\n#> 0.005181438 [1]"},{"path":"naturtype1.html","id":"temporal-trend","chapter":"3 Nature types - Part 1","heading":"3.3 Temporal trend","text":"\nFigure 3.1: Temproal trend nature type mapping using Miljødirektoratets Instruks\nrate nature type mapping strongly positive last three years. differences field mapping instructions years. need decide whether include years, perhaps exclude first year.","code":"\ndat$kartleggingsår <- as.numeric(dat$kartleggingsår)\narea_year <- as.data.frame(tapply(dat$area, dat$kartleggingsår, sum))\nnames(area_year) <- \"area\"\narea_year$year <- row.names(area_year)\narea_year$area_km2 <- area_year$area/10^6\nggplot(area_year)+\n  geom_bar(aes(x = year, y = area_km2),\n           stat = \"identity\",\n           fill = \"grey\",\n           colour=\"black\",\n           size = 1.2)+\n  theme_bw(base_size = 12)+\n  labs(x = \"Year\", y = \"Total mapped area (km/2)\")"},{"path":"naturtype1.html","id":"condition","chapter":"3 Nature types - Part 1","heading":"3.4 Condition","text":"quick overview condition scores\nFigure 3.2: overal distribution condition scores\nsites/polygons either good moderately good condition. ’m sure first class represents. seems like polygons don’t condition score. Looking just data set, also online faktaark localities, give answer:figure show cases restricted just one field season.\nFigure 3.3: Temporal trend localities without condition scores.\n\nFigure 3.4: Main ecosystems localities missing condition scores.\ncases restricted two main ecosystems, one class main ecosystem recorded. Looking cases clear relevant work , don’t know data set begin .\nFigure 3.5: Nature types localities missing condition scores.\nsix nature types (exclude mapped) don’t condition score.Snøleieblokkmark rabbeblokkmark protocol assessing condition status. Leirskredgrop, leirravine grotte nature types 2018 (mapped 2021), similarly assessed condition scores. Isinnfrysingsmark assessed condition now, 2018. can therefore exclude localities data set.","code":"\nbarplot(tapply(dat$area/10^6, factor(dat$tilstand), sum))\nView(dat[dat$tilstand==\"\",])\nbarplot(table(dat$kartleggingsår[dat$tilstand==\"\"]), \n        ylab=\"Number of localities without condition scores\",\n        xlab=\"Year\")\npar(mar=c(5,20,1,1))\nbarplot(table(dat$hovedøkosystem[dat$tilstand==\"\"]),\n        horiz = T, las=2,\n        xlab=\"Number of localities without condition scores\")\npar(mar=c(5,20,1,1))\nbarplot(table(dat$naturtype[dat$tilstand==\"\"]),\n        horiz = T, las=2,\n        xlab=\"Number of localities without condition scores\")\ndat <- dat[dat$tilstand!=\"\",]"},{"path":"naturtype1.html","id":"mosaic-types","chapter":"3 Nature types - Part 1","heading":"3.5 Mosaic types","text":"field mapping instruction include option delineating mosaic types. Let’s investigate cases.area displays repeating pattern mixed nature types smaller minimum mapping unit MMU, grouped many overlapping polygons unique nature types. Within nature type polygons, distribution NiN-grunntyper (online can see percentage distribution, data set presence/absence data) assigned different nature types (nature types Environmental agencies classification). condition scoring can unique overlapping nature type mosaic. don’t know precise location NiN-grunntyper part mosaic nature types.\nFigure 3.6: number mosaic localities relatively small.\nFix duplicated hovedøkosystem\nFigure 3.7: Distribution mosaic nature types across hovedøkosystem\nMosaic localities occur many main ecosystems (many nature types therein).conclusion thatMosaic localities used pin-point NiN grunntyper (e.g. remote sensing purposes).Mosaic localities CAN used extract condition scores nature types, tied NiN grunntype listed polygon, include belong part(s) mosaic.","code":"\nbarplot(table(dat$mosaikk),\n        xlab = \"Mosaic\", ylab=\"Number of localities\")\n#unique(dat$hovedøkosystem)\ndat$hovedøkosystem[dat$hovedøkosystem==\"Naturlig åpne områder i lavlandet\"] <- \"Naturlig åpne områder under skoggrensa\"\npar(mar=c(5,20,1,1))\nbarplot(table(dat$hovedøkosystem[dat$mosaikk==\"Ja\"]),\n        horiz = T, las=2,\n        xlab=\"Number of mosaic localities\")"},{"path":"naturtype1.html","id":"nin-types-across-main-ecosystems","chapter":"3 Nature types - Part 1","heading":"3.6 NiN types across main ecosystems","text":"NiN main types can extracted column ninkartleggingsenheter, oddly concatenated. Let’s tease apart.\nFigure 3.8: number NiN main types within one locality normally one, except mosaic localities.\nMosaic localities much higher likelihood including multiple NiN main types, also occurs non-mosaic localities (8000 cases), need see whats going .First need melt data frame order tally number NiN min types within hovedøkosystem.\nFigure 3.9: Figure showing number localities NiN main type. One locality can one NiN main type. Mosaic localities excluded figure.\nlot miss-match NiN main types hovedøkosystem.\nTaking one example: T2 (åpne grunnledt mark) found mountains, one case occurs. view case.. find online fact sheet locality, see indeed mosaic. nature type called Kalkfattig og intermediær fjellhei, leside og tundra defined strictly T3, field surveyor recorded lots main NiN types. mistake. Online can see locality 50% T3, information data set available. order NiN types ninkartleggingsenheter column reflecting commonness types ether.way extract defining NiN type naturtype column, nice. exclude localities mosaics, multiple NiN main types, first need know naturtype allow multiple NiN main types.next figure show, cases correlated mapping year, hence changes field protocol.\nFigure 3.10: ten common nature types number localities multiple NiN main types\n‘Hule eiker’ special case recorded points polygons, can found NiN main type hovedøkosystem.Kystlynghei often occurs mosaic, figure ?? excluded mosaic localities, kystlynghei strictly defined T34.\ntrue naturbeitemark restricted T32.\nMaybe recorded mosaic localities. case, automatically extract main NiN type rows now. One option manually define naturbeitemark T32, kystlynghei T34, also without risk.Lets look NiN main types cover different hovedøkosystem exclude Hule eiker localities one NiN main type.\nFigure 3.11: NiN main type across five main ecosystems (Hule eiker, mosaic localities, localities >1 NiN main type excluded)\nLet’s focus three targeted ecosystems.\nFigure 3.12: Number localities combination main ecosystem NiN main type\nStill weird cases look turn .","code":"\n#dat$ninkartleggingsenheter[1:10]\ndat$ninkartleggingsenheter2 <- gsub(\"NA_\", dat$ninkartleggingsenheter, replacement = \"\")\n#dat$ninkartleggingsenheter2[1:30]\ndat$ninkartleggingsenheter2 <- str_replace_all(dat$ninkartleggingsenheter2, \".[CE].[\\\\d]{1,}\", replacement = \"\")\n#dat$ninkartleggingsenheter2[1:30]\ndat$ninkartleggingsenheter2 <- str_replace_all(dat$ninkartleggingsenheter2, \"-.\", replacement = \"\")\nuni <- function(x){paste(unique(unlist(strsplit(x, \",\"))), collapse = \",\")}\ndat$ninkartleggingsenheter3 <- lapply(dat$ninkartleggingsenheter2, uni)\nn_uni <- function(x){length(unique(unlist(strsplit(x, \",\"))))}\ndat$n_ninkartleggingsenheter <- lapply(dat$ninkartleggingsenheter2, n_uni)\ndat$n_ninkartleggingsenheter <- as.numeric(dat$n_ninkartleggingsenheter) \n\npar(mfrow=c(1,3))\nbarplot(table(dat$n_ninkartleggingsenheter),\n        xlab = \"Number of NiN main types\",\n        ylab = \"Number of localities\")\nbarplot(table(dat$n_ninkartleggingsenheter[dat$mosaikk==\"Nei\"]),\n        xlab = \"Number of NiN main types\\n(Mosaic localities excluded)\")\nbarplot(table(dat$n_ninkartleggingsenheter[dat$mosaikk==\"Ja\"]),\n        xlab = \"Number of NiN main types\\n(Mosaic localities only)\")\ndat_melt <- tidyr::separate_rows(dat, ninkartleggingsenheter3)\nggplot(dat_melt[dat_melt$mosaikk!=\"Ja\",])+\n  geom_bar(aes(x = ninkartleggingsenheter3))+\n  coord_flip()+\n  theme_bw(base_size = 12)+\n  facet_wrap(\"hovedøkosystem\",\n             scales = \"free\")\nView(dat_melt[dat_melt$mosaikk!=\"Ja\" & dat_melt$hovedøkosystem==\"Fjell\" & dat_melt$ninkartleggingsenheter3==\"T2\",])\npar(mar=c(2,6,2,2))\ntemp <- dat[dat$n_ninkartleggingsenheter>1 & dat$mosaikk!=\"Ja\",]\nbarplot(table(temp$kartleggingsår), ylab=\"Number of localities with more than one NiN main type\\n(mosaic localitie excluded) \")\ntemp2 <- as.data.frame(table(temp$naturtype, temp$n_ninkartleggingsenheter))\ntemp2 <- temp2[base::order(temp2$Freq, decreasing = T),][1:10,]\npar(mar=c(8,20,1,1))\nbarplot(temp2$Freq, names.arg = temp2$Var1, las=2,\n        horiz = T, xlab = \"Number of localities with >1 NiN main type\")\nDT::datatable(\n  dat[dat$naturtype==\"Hule eiker\",][1:5,c(\"naturtype\", \"hovedøkosystem\", \"ninkartleggingsenheter\")])\ndat_red <- dat_melt[dat_melt$n_ninkartleggingsenheter==1 & \n                      dat_melt$naturtype != \"Hule eiker\" &\n                      dat_melt$mosaikk == \"Nei\",]\nggplot(dat_red)+\n  geom_bar(aes(x = ninkartleggingsenheter3),\n           fill=\"grey\",\n           colour=\"black\")+\n  coord_flip()+\n  theme_bw(base_size = 12)+\n  facet_wrap(\"hovedøkosystem\",\n             scales = \"free\")+\n  labs(y = \"Number of localities\",\n       x = \"NiN main types\")\ndat_red_tally <- stats::aggregate(data = dat_red,\n                                  area~hovedøkosystem+ninkartleggingsenheter3, FUN = length)\nnames(dat_red_tally)[3] <- \"count\"\ntarget <- c(\"Semi-naturlig mark\",\n            \"Våtmark\",\n            \"Naturlig åpne områder under skoggrensa\")\nggplot(dat_red_tally[dat_red_tally$hovedøkosystem %in% target,],\n       aes(x = ninkartleggingsenheter3,\n               y = count))+\n  geom_bar(\n           fill=\"grey\",\n           colour=\"black\",\n           stat=\"identity\")+\n  coord_flip()+\n  theme_bw(base_size = 12)+\n  labs(y = \"Number of localities\",\n       x = \"NiN main types\")+\n  scale_y_continuous(position = \"left\",\n                   expand = expansion(mult=c(.0,.3)))+\n  geom_text(aes(label=count), hjust=-0.25)+\n    facet_wrap(\"hovedøkosystem\",\n             scales = \"free\",\n             ncol = 3)"},{"path":"naturtype1.html","id":"naturlig-åpne-områder-under-skoggrensa","chapter":"3 Nature types - Part 1","heading":"3.6.1 Naturlig åpne områder under skoggrensa","text":"V10 (semi-naturlig våteng)\nOne case Åpen flomfastmark wrongly associated V10 whan T18.\nExclude case\nOne case Åpen flomfastmark wrongly associated V10 whan T18.Exclude caseT8 (fulglefjelleng og fugltopp)\nOk\nOkT6 (Standberg)\nOk\nOkT33 (Semi naturlig strandeng)\ncases either naturtype semi-naturlig strandeng (hence hovedøkosystem Semi-nat), naturtype correctly recorded Strandeng NiN type T12.\nExclude\ncases either naturtype semi-naturlig strandeng (hence hovedøkosystem Semi-nat), naturtype correctly recorded Strandeng NiN type T12.ExcludeT32 (Semi-naturlig eng)\nObvious error\nExclude\nObvious errorExcludeT30 (Flomskogsmark)\nObvious error\nExclude\nObvious errorExcludeT29 (Grus og steindominert strand og strandlinje)\nOk\nOkT21 (Sanddynemark)\nOk\nOkT20 (Isinnfrysingsmark)\nOk. Rare nature type\nOk. Rare nature typeT2 (Åpen grunlendt mark)\nOk\nOkT18 (Åpne flomfastmark)\nOk\nOkT17 (Aktiv skredmark)\nOk\nOkT15 (Fosse-eng)\nOk\nOkT13 (Rasmark)\nOk\nOkT12 (Strandeng)\nOk\nOkT1 (Nakent berg)\nOk\nOk","code":"\n#View(dat_red[dat_red$hovedøkosystem==\"Naturlig åpne områder under skoggrensa\" & dat_red$ninkartleggingsenheter3 == \"V10\",])\n#View(dat_red[dat_red$hovedøkosystem==\"Naturlig åpne områder under skoggrensa\" & dat_red$ninkartleggingsenheter3 == \"T33\",])\n#View(dat_red[dat_red$hovedøkosystem==\"Naturlig åpne områder under skoggrensa\" & dat_red$ninkartleggingsenheter3 == \"T32\",])\n\n`%!in%` <- Negate(`%in%`)\ndat_red2 <- dat_red[\n  dat_red$hovedøkosystem!=\"Naturlig åpne områder under skoggrensa\" |\n  dat_red$hovedøkosystem==\"Naturlig åpne områder under skoggrensa\" & \n    dat_red$ninkartleggingsenheter3 %!in% c(\"T30\", \"T32\", \"T33\", \"V10\"),]"},{"path":"naturtype1.html","id":"semi-naturlig-mark","chapter":"3 Nature types - Part 1","heading":"3.6.2 Semi-naturlig mark","text":"V9 (Semi-naturlig myr)\nKystlynghei recorded mire\nExclude\nKystlynghei recorded mireExcludeV10 (semi-nat våteng)\nOk\nOkT41 (Oppdyrket mark med preg av semi-naturlig eng)\nProbably always use correctly, least correct `hovedkøosystem\nOk\nProbably always use correctly, least correct `hovedkøosystemOkT40 (Sterkt endret fastmark med preg av semi-naturlig eng)\nOk\nOkT4 (Fastmarksskogsmark)\nT32 (naturbeitemark, lauveng, hagemark, +++)\nExclude\nT32 (naturbeitemark, lauveng, hagemark, +++)ExcludeT35 (Sterkt endret fastmark med løsmassedekke)\nWrong NiN type given eng-aktig sterkt endret fastmark (T40)\nExclude\nWrong NiN type given eng-aktig sterkt endret fastmark (T40)ExcludeT31-34\nOk\nOkT3 (Fjellhei, leside og tundra)\nBoreal hei (’ve T31)\nExclude\nBoreal hei (’ve T31)ExcludeT12 (Strandeng)\nprobably T33\nExclude\nprobably T33ExcludeT1 (Nakent berg)\nObvious mistake\nExclude\nObvious mistakeExclude","code":"\n#unique(dat$hovedøkosystem)\n#View(dat_red[dat_red$hovedøkosystem==\"Semi-naturlig mark\" & dat_red$ninkartleggingsenheter3 == \"V9\",])\n#View(dat_red[dat_red$hovedøkosystem==\"Semi-naturlig mark\" & dat_red$ninkartleggingsenheter3 == \"T41\",])\n#View(dat_red[dat_red$hovedøkosystem==\"Semi-naturlig mark\" & dat_red$ninkartleggingsenheter3 == \"T4\",])\n#View(dat_red[dat_red$hovedøkosystem==\"Semi-naturlig mark\" & dat_red$ninkartleggingsenheter3 == \"T35\",])\n#View(dat_red[dat_red$hovedøkosystem==\"Semi-naturlig mark\" & dat_red$ninkartleggingsenheter3 == \"T3\",])\n#View(dat_red[dat_red$hovedøkosystem==\"Semi-naturlig mark\" & dat_red$ninkartleggingsenheter3 == \"T1\",])\n\ndat_red3 <- dat_red2[\n  dat_red2$hovedøkosystem!=\"Semi-naturlig mark\" |\n  dat_red2$hovedøkosystem==\"Semi-naturlig mark\" & dat_red2$ninkartleggingsenheter3 %!in% c(\"V9\", \"T4\", \"T35\", \"T3\", \"T12\", \"T1\"),]"},{"path":"naturtype1.html","id":"våtmark","chapter":"3 Nature types - Part 1","heading":"3.6.3 Våtmark","text":"Våtmakr doesn’t distinguish semi-natural natural, V-types correct, except perhaps strongly modified V11-V13.V11 (Torvtak)\nObvious mistake\nExclude\nObvious mistakeExcludeV12 (Grøftet åpne torvmark)\nObvious mistake\nExclude\nObvious mistakeExcludeV13 (Ny våtmark)\nObvious mistake\nExclude\nObvious mistakeExcludeT4 (skog)\n’ve T2 strange things\nExclude\n’ve T2 strange thingsExcludeT30-T32\nSomeone switching semi-natural natural equivalents\nExclude\nSomeone switching semi-natural natural equivalentsExcludeL4 (Helofyttsump)\nOk\nOkLet’s make plot see worked\nFigure 3.13: Number localities combination main ecosystem NiN main type (data set cleaning)\n","code":"\n#unique(dat$hovedøkosystem)\n#w(dat_red[dat_red$hovedøkosystem==\"Våtmark\" & dat_red$ninkartleggingsenheter3 == \"T4\",])\n#w(dat_red[dat_red$hovedøkosystem==\"Våtmark\" & dat_red$ninkartleggingsenheter3 == \"T32\",])\n#w(dat_red[dat_red$hovedøkosystem==\"Våtmark\" & dat_red$ninkartleggingsenheter3 == \"L4\",])\n#w(dat_red[dat_red$hovedøkosystem==\"Våtmark\" & dat_red$ninkartleggingsenheter3 == \"V9\",])\n#w(dat_red[dat_red$hovedøkosystem==\"Våtmark\" & dat_red$ninkartleggingsenheter3 == \"V11\",])\n#w(dat_red[dat_red$hovedøkosystem==\"Våtmark\" & dat_red$ninkartleggingsenheter3 == \"V12\",])\n#w(dat_red[dat_red$hovedøkosystem==\"Våtmark\" & dat_red$ninkartleggingsenheter3 == \"V13\",])\ndat_red4 <- dat_red3[\n  dat_red3$hovedøkosystem!=\"Våtmark\" |\n  dat_red3$hovedøkosystem==\"Våtmark\" & dat_red3$ninkartleggingsenheter3 %!in% c(\"T4\", \"T30\", \"T31\", \"T32\", \"V11\", \"V12\", \"V13\"),]\ndat_red_tally2 <- stats::aggregate(data = dat_red4,\n                                 area~hovedøkosystem+ninkartleggingsenheter3, FUN = length)\nnames(dat_red_tally2)[3] <- \"count\"\n\n\nggplot(dat_red_tally2[dat_red_tally2$hovedøkosystem %in% target,],\n       aes(x = ninkartleggingsenheter3,\n               y = count))+\n  geom_bar(\n           fill=\"grey\",\n           colour=\"black\",\n           stat=\"identity\")+\n  coord_flip()+\n  theme_bw(base_size = 12)+\n  labs(y = \"Number of localities\",\n       x = \"NiN main types\")+\n  scale_y_continuous(position = \"left\",\n                   expand = expansion(mult=c(.0,.3)))+\n  geom_text(aes(label=count), hjust=-0.25)+\n    facet_wrap(\"hovedøkosystem\",\n             scales = \"free\",\n             ncol = 3)"},{"path":"naturtype1.html","id":"areal","chapter":"3 Nature types - Part 1","heading":"3.6.4 Areal","text":"type analysis , focusing onthe accumalitive mapped rea.\nFigure 3.14: Total mapped combination main ecosystem NiN main type (data set cleaning)\n","code":"\ndat_red_tally_area <- stats::aggregate(data = dat_red4,\n                                 area~hovedøkosystem+ninkartleggingsenheter3, FUN = sum)\nnames(dat_red_tally_area)[3] <- \"area_m2\"\ndat_red_tally_area$area_km2 <- drop_units(dat_red_tally_area$area_m2/10^6)\nggplot(dat_red_tally_area[dat_red_tally_area$hovedøkosystem %in% target,],\n       aes(x = ninkartleggingsenheter3,\n               y = area_km2))+\n  geom_bar(\n           fill=\"grey\",\n           colour=\"black\",\n           stat=\"identity\")+\n  coord_flip()+\n  theme_bw(base_size = 12)+\n  labs(y = \"Total mapped area (km/2)\",\n       x = \"NiN main types\")+\n    facet_wrap(\"hovedøkosystem\",\n             scales = \"free\",\n             ncol = 3)"},{"path":"naturtype1.html","id":"export","chapter":"3 Nature types - Part 1","heading":"3.7 Export","text":"dat_red4 now one row per locality, localities 1 NiN main type. Hule eiker Mosaic localities included, add back now. Depending data set used , last two can excluded later.remove hule eiker, use thisTo remove mosaic localities, first consider want remove mosaic localities, just include different NiN main types, mosaic locality may also consist different sub units (grunntype) within NiN main type, even grunntype throughout, varying parameter (e.g. mosaic old pine forest old spruce forest, T4 , say T4-C-2).exclude mosaics general:exclude mosaics include multiple NiN main types:save rds file personal folder (shape standard truncates field names, gdb soo easy use R), manually move \n/data/P-Prosjekter/41201785_okologisk_tilstand_2022_2023/data/Mdir_Naturtyper_cleanedALK.shp.\nsimply access drive RStudio Server moment.code importing cleaned data back R ()","code":"\nexp <- rbind(dat_red4,\n             dat[dat$mosaikk==\"Ja\",],\n             dat[dat$naturtype== \"Hule eiker\",])\nexp[exp$naturtype != \"Hule eiker\",]\nexp[exp$mosaikk == \"Nei\",]\nexp[exp$n_ninkartleggingsenheter == 1]\nexp$ninkartleggingsenheter3 <- unlist(exp$ninkartleggingsenheter3)\nsaveRDS(exp, \"/data/Egenutvikling/41001581_egenutvikling_anders_kolstad/data/Mdir_Naturtyper_cleanedALK.rds\")\n#myData <- readRDS(\"/data/Egenutvikling/41001581_egenutvikling_anders_kolstad/data/Mdir_Naturtyper_cleanedALK.rds\")\nmyData <- readRDS(\"/data/P-Prosjekter/41201785_okologisk_tilstand_2022_2023/data/Mdir_Naturtyper_cleanedALK.rds\")"},{"path":"naturtype1.html","id":"overview-of-nature-types","chapter":"3 Nature types - Part 1","heading":"3.8 Overview of nature types","text":"\nFigure 3.15: overview nature types data set\n","code":"\ntemp <- tapply(exp$area, exp$naturtype, sum)\ntemp <- data.frame(nat = row.names(temp),\n                   area = temp)\n\nggplot(exp[exp$hovedøkosystem %in% target,], \n       aes(x = naturtype))+\n  geom_bar(fill = \"grey20\",\n           size=0\n           )+\n  theme_bw(base_size = 12)+\n  coord_flip()+\n  facet_grid(rows = vars(hovedøkosystem),\n             scales = \"free\",\n             space = \"free\")+\n  labs(y = \"Number of localities\",\n       x = \"Nature type\")"},{"path":"naturtype2.html","id":"naturtype2","chapter":"4 Nature types - Part 2","heading":"4 Nature types - Part 2","text":"application naturetype dataset - Part 2 - Representativity Author: Anders L. KolstadDate: 2022-10-11This chapter continues cleaned dataset exported end previous chapter:","code":"\ndat <- readRDS(\"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/Mdir_Naturtyper_cleanedALK.rds\")"},{"path":"naturtype2.html","id":"naturetypes-condition-variables-and-their-linkage-to-nin-main-types","chapter":"4 Nature types - Part 2","heading":"4.1 Naturetypes, condition variables, and their linkage to NiN main types","text":"subset nature types mapped. well mapped units/areas represent range nature types included main ecosystem group? condition variables available ?","code":""},{"path":"naturtype2.html","id":"nature-types","chapter":"4 Nature types - Part 2","heading":"4.1.1 Nature types","text":"Lets extract unique nature types, associated main ecosystem, year nature types mapped.include target ecosystems, exclude Hule eiker.Get unique nature typesExtract year mappedExtract associated ecosystemCombine one data frameWe 66 nature types consider. wetland types can actually excluded way limited ecosystem mean open wetland.\nFigure 3.1: List nature types showing years nature type mapped.\nway think look nature type turn map NiN main types sub-types cover. time can extract NiN variables values see distribute NiN main types.","code":"\ntarget <- c(\"Semi-naturlig mark\",\n            \"Våtmark\",\n            \"Naturlig åpne områder under skoggrensa\")\ndat <- dat[dat$hovedøkosystem %in% target,]\ndat <- dat[dat$naturtype != \"Hule eiker\",]\nntyp <- unique(dat$naturtype)\nyears <- NULL\nfor(i in 1:length(ntyp)){\nyears[i] <- paste(sort(unique(dat$kartleggingsår[dat$naturtype == ntyp[i]])), collapse = \", \")\n}\neco <- NULL\nfor(i in 1:length(ntyp)){\neco[i] <- paste(unique(dat$hovedøkosystem[dat$naturtype == ntyp[i]]), collapse = \", \")\n}\nntypDF <- data.frame(\n  \"Nature_type\" = ntyp,\n  \"Year\"        = years,\n  \"Ecosystem\"   = eco\n)\nexcl_nt <- c(\"Kalkrik myr- og sumpskogsmark\",\n             #\"Flommyr, myrkant og myrskogsmark\",  # Only V9 is relevant. This type also includes V2 and V8\n             \"Gammel fattig sumpskog\",\n             \"Rik gransumpskog\",\n             \"Grankildeskog\",\n             \"Rik svartorsumpskog\",\n             \"Rik gråorsumpskog\",\n             \"Rik svartorstrandskog\",\n             \"Saltpåvirket svartorstrandskog\",\n             \"Kilde-edellauvskog\",\n             \"Saltpåvirket strand- og sumpskogsmark\",\n             \"Svak kilde og kildeskogsmark\",\n             \"Rik vierstrandskog\",\n             \"Varmekjær kildelauvskog\"\n             )\n`%!in%` <- Negate(`%in%`)\nntypDF <- ntypDF[ntypDF$Nature_type %!in% excl_nt,]\nDT::datatable(ntypDF)"},{"path":"naturtype2.html","id":"nin-variables","chapter":"4 Nature types - Part 2","heading":"4.1.2 NiN variables","text":"Nin variable codes:Converting NiN_variable_value numeric also introduced NA’s categories:now go variable codes separately also judge NA’s real, example coded zeros something.","code":"\n#Exclude non-relevant types\ndat2 <- dat[dat$naturtype %!in% excl_nt,]\n\n# Melt\ndat2L <- tidyr::separate_rows(dat2, ninbeskrivelsesvariabler, sep=\",\")\n\n# Split the code and the value into separate columns\ndat2L <- tidyr::separate(dat2L, \n                              col = ninbeskrivelsesvariabler,\n                              into = c(\"NiN_variable_code\", \"NiN_variable_value\"),\n                              sep = \"_\",\n                              remove=F\n                              )\n#> Warning: Expected 2 pieces. Missing pieces filled with `NA`\n#> in 1 rows [280973].\n# One NA produced here, but I check it, and it's fine.\n\n# Convert values to numeric. This causes some NA's which I will go through below\ndat2L$NiN_variable_value <- as.numeric(dat2L$NiN_variable_value)\n#> Warning: NAs introduced by coercion\nunique(sort(dat2L$NiN_variable_code))\n#>  [1] \"1AG-A-0\"   \"1AG-A-E\"   \"1AG-A-G\"   \"1AG-B\"    \n#>  [5] \"1AG-C\"     \"1AR-C-L\"   \"3TO-BØ\"    \"3TO-HA\"   \n#>  [9] \"3TO-HE\"    \"3TO-HK\"    \"3TO-HN\"    \"3TO-HP\"   \n#> [13] \"3TO-PA\"    \"3TO-TE\"    \"4DL-S-0\"   \"4DL-SS-0\" \n#> [17] \"4TG-BL\"    \"4TG-EL\"    \"4TG-GF\"    \"4TL-BS\"   \n#> [21] \"4TL-HE\"    \"4TL-HL\"    \"4TL-RB\"    \"4TL-SB\"   \n#> [25] \"5AB-0\"     \"5AB-DO-TT\" \"5BY-0\"     \"6SE\"      \n#> [29] \"6SO\"       \"7FA\"       \"7GR-GI\"    \"7JB-BA\"   \n#> [33] \"7JB-BT\"    \"7JB-GJ\"    \"7JB-HT-SL\" \"7JB-HT-ST\"\n#> [37] \"7JB-KU-BY\" \"7JB-KU-DE\" \"7JB-KU-MO\" \"7JB-KU-PI\"\n#> [41] \"7RA-BH\"    \"7RA-SJ\"    \"7SD-0\"     \"7SD-NS\"   \n#> [45] \"7SE\"       \"7TK\"       \"7VR-RI\"    \"LKMKI\"    \n#> [49] \"LKMSP\"     \"PRAK\"      \"PRAM\"      \"PRH\"      \n#> [53] \"PRHA\"      \"PRHT\"      \"PRKA\"      \"PRKU\"     \n#> [57] \"PRMY\"      \"PRRL-CR\"   \"PRRL-DD\"   \"PRRL-EN\"  \n#> [61] \"PRRL-NT\"   \"PRRL-VU\"   \"PRSE-KA\"   \"PRSE-PA\"  \n#> [65] \"PRSE-SH\"   \"PRSL\"      \"PRTK\"      \"PRTO\"     \n#> [69] \"PRVS\"\nsort(unique(dat2L$NiN_variable_code[is.na(dat2L$NiN_variable_value)]))\n#>  [1] \"4DL-S-0\"   \"4DL-SS-0\"  \"5AB-0\"     \"5BY-0\"    \n#>  [5] \"7FA\"       \"7GR-GI\"    \"7JB-BA\"    \"7JB-BT\"   \n#>  [9] \"7JB-GJ\"    \"7JB-KU-BY\" \"7JB-KU-DE\" \"7JB-KU-MO\"\n#> [13] \"7JB-KU-PI\" \"7RA-SJ\"    \"7SD-0\"     \"7SD-NS\"   \n#> [17] \"7SE\"       \"7TK\"       \"7VR-RI\"    \"LKMKI\"    \n#> [21] \"LKMSP\"     \"PRH\"       \"PRVS\""},{"path":"naturtype2.html","id":"ag-a-sjiktdekningsvariabler","chapter":"4 Nature types - Part 2","heading":"4.1.2.1 1AG-A (sjiktdekningsvariabler)","text":"different variables describing cover different vegetation strata /species1AG--0 = Total tre canopy cover1AG-B = Total shrub cover1AG-C = Total field layer cover1AG--E = ‘Overstandere’1AG--G = ‘gjenveksttrær’","code":""},{"path":"naturtype2.html","id":"ar-c-l-andel-vedvekster-i-fletsjiktet","chapter":"4 Nature types - Part 2","heading":"4.1.2.2 1AR-C-L (Andel vedvekster i fletsjiktet)","text":"condition variable mire nature types","code":""},{"path":"naturtype2.html","id":"to-torvmarksformer","chapter":"4 Nature types - Part 2","heading":"4.1.2.3 3TO (Torvmarksformer)","text":"defining variables, part condition assessment.","code":"\nexclude <- c(\"3TO-BØ\",\n             \"3TO-HA\",\n             \"3TO-HE\",\n             \"3TO-HK\",\n             \"3TO-HN\",\n             \"3TO-HP\",\n             \"3TO-PA\",\n             \"3TO-TE\")"},{"path":"naturtype2.html","id":"dl-coarse-dead-wood","chapter":"4 Nature types - Part 2","heading":"4.1.2.4 4DL (Coarse dead wood)","text":"4DL-SS-0 4DL-S-0 total amount coarse woody debris/logs. recorded one nature type 2018, biodiversity variable, state variable. Biodiversity variables recorded condition better poor. bias means use variables.Biodiversity variables recorded condition better poor. bias means use variables.","code":"\nexclude <- c(exclude,\n             \"4DL-SS-0\",\n             \"4DL-S-0\")"},{"path":"naturtype2.html","id":"tg-old-trees","chapter":"4 Nature types - Part 2","heading":"4.1.2.5 4TG (old trees)","text":"three variables used biodiveristy variables 2018 (exclude).","code":"\nexclude <- c(exclude,\n             \"4TG-BL\",\n             \"4TG-EL\",\n             \"4TG-GF\")"},{"path":"naturtype2.html","id":"tl-trees-with-fire-scars","chapter":"4 Nature types - Part 2","heading":"4.1.2.6 4TL (trees with fire scars)","text":"five variables used together 4TG biodiversity variables 2018.","code":"\nexclude <- c(exclude,\n             \"4TL-BS\",\n             \"4TL-HE\",\n             \"4TL-HL\",\n             \"4TL-RB\",\n             \"4TL-SB\")"},{"path":"naturtype2.html","id":"ab-and-5by-arealbruksklasser-og-byggningstyper","chapter":"4 Nature types - Part 2","heading":"4.1.2.7 5AB and 5BY (arealbruksklasser og byggningstyper)","text":"area land use types building types, respectively, values numeric, categorical, represents presence absence land uses objects. suited automatically determining ecosystem condition done subjectively field.","code":"\nexclude <- c(exclude,\n             \"5AB-0\",\n             \"5AB-DO-TT\",\n             \"5BY-0\"\n             )"},{"path":"naturtype2.html","id":"se-and-6so-bioclimatical-sections-and-sones","chapter":"4 Nature types - Part 2","heading":"4.1.2.8 6SE and 6SO (Bioclimatical sections and sones)","text":"relevant condition variables.","code":"\nexclude <- c(exclude,\n             \"6SE\",\n             \"6SO\")"},{"path":"naturtype2.html","id":"fa-fremmedartsinnslag","chapter":"4 Nature types - Part 2","heading":"4.1.2.9 7FA (fremmedartsinnslag)","text":"allowed value X, Ok exclude .\n7FA also potentially issue related NiN-app build doesn’t allow registering alien species fremmedartsliste.","code":""},{"path":"naturtype2.html","id":"gr-gi","chapter":"4 Nature types - Part 2","heading":"4.1.2.10 7GR-GI","text":"7GR-GI (grøftingsintensitet) value X either, OK exclude NA’s. keep variable, even though clearly pressure indikator, might want use surrogate mire hydrology.","code":""},{"path":"naturtype2.html","id":"jb-ku-kystlyngheias-utviklingsfaser","chapter":"4 Nature types - Part 2","heading":"4.1.2.11 7JB-KU (Kystlyngheias utviklingsfaser)","text":"= byggefaseDE = degenereringsfaseMO = moden fasePI = pionerfaseThis variable used biodiversity assessment, can therefore used condition assessment localities poor conditions mapped/assessed.nonetheless explore variable bit .\nNiN defines possible values numeric 0 4 (shifted become 1-5 dataset), 544 cases given value X.reason variable used biodiversity assessment, performed condition poor.case: condition scored low, variable even appear data set locality.can also make note big proportion total number localities Kystlynghei poor condition, therefore variable 7JB-KU recorded large proportion localities.\nFigure 4.1: distribution condition scores Kystlynghei.\nkystlynghei locality values four parameters (7BA-/DE/MO/PI), look cases detail, understand values set X (probably means left blank), example like :… can see sometimes <4 >0 variables/phases given score, sometimes none . makes problematic set NA’s zeros. also consider fact obvious bias localities poor condition better variables assessed first place, exclude variables treat suited.","code":"\nexclude <- c(exclude, \n             \"7JB-KU-BY\", \n             \"7JB-KU-DE\", \n             \"7JB-KU-MO\", \n             \"7JB-KU-PI\")\ntemp <- dat2L[dat2L$ninbeskrivelsesvariabler == \"7JB-KU-BY_X\" |\n                     dat2L$ninbeskrivelsesvariabler == \"7JB-KU-DE_X\" |\n                dat2L$ninbeskrivelsesvariabler == \"7JB-KU-MO_X\" |\n                     dat2L$ninbeskrivelsesvariabler == \"7JB-KU-PI_X\",]\ntable(temp$kartleggingsår, temp$naturtype)\n#>       \n#>        Kystlynghei\n#>   2018         437\n#>   2019          27\n#>   2020           9\n#>   2021          64\ntable(temp$tilstand)\n#> \n#>  Dårlig     God Moderat \n#>      96      57     384\nKU <- dat2[dat2$naturtype==\"Kystlynghei\",]\nbarplot(table(KU$tilstand))\n#View(dat2L[dat2L$NiN_variable_code == \"7JB-KU-BY\" & is.na(dat2L$NiN_variable_value),])\n#View(dat2L[dat2L$identifikasjon_lokalid ==\"NINFP1810002975\",]) # None of the 7JB-KU variables have values\n#View(dat2L[dat2L$identifikasjon_lokalid ==\"NINFP2110057689\",]) # Two of the 7JB-KU variables have values"},{"path":"naturtype2.html","id":"jb-ba-aktuell-bruksintensitet","chapter":"4 Nature types - Part 2","heading":"4.1.2.12 7JB-BA (Aktuell bruksintensitet)","text":"common condition variable semi-natural nature types. ’s borderline pressure indicator, keep data set now least.Overview cases value set X.just cases, mostly 2018. OK treat NA.","code":"\ntemp <- dat2L[dat2L$ninbeskrivelsesvariabler == \"7JB-BA_X\",]\ntable(temp$kartleggingsår, temp$naturtype)\n#>       \n#>        Hagemark Semi-naturlig eng Semi-naturlig strandeng\n#>   2018        0                 0                       0\n#>   2021        1                 1                       1\n#>       \n#>        Strandeng\n#>   2018        27\n#>   2021         0"},{"path":"naturtype2.html","id":"jb-bt-beitetrykk","chapter":"4 Nature types - Part 2","heading":"4.1.2.13 7JB-BT (Beitetrykk)","text":"Similar variable .OK treat X’s NA’s.","code":"\ntemp <- dat2L[dat2L$ninbeskrivelsesvariabler == \"7JB-BT_X\",]\ntable(temp$kartleggingsår, temp$naturtype)\n#>       \n#>        Åpen flomfastmark Kystlynghei Sanddynemark\n#>   2019                 3           0            0\n#>   2020                 1           1            2\n#>   2021                 3           0            0"},{"path":"naturtype2.html","id":"jb-gj-gjødsling","chapter":"4 Nature types - Part 2","heading":"4.1.2.14 7JB-GJ (Gjødsling)","text":"Similar variable two .OK treat X’s NA’s.variable used condition indicator, questioned. Firstly, pressure indicator. Secondly, many semi-natural areas fertilized, also reference condition. people made meadows probably agree productive field/meadow poor condition. condition variable therefor directly tuned towards maintenance biodiversity.","code":"\ntemp <- dat2L[dat2L$ninbeskrivelsesvariabler == \"7JB-BT_X\",]\ntable(temp$kartleggingsår, temp$naturtype)\n#>       \n#>        Åpen flomfastmark Kystlynghei Sanddynemark\n#>   2019                 3           0            0\n#>   2020                 1           1            2\n#>   2021                 3           0            0"},{"path":"naturtype2.html","id":"jb-ht-høsting-av-tresjiktet","chapter":"4 Nature types - Part 2","heading":"4.1.2.15 7JB-HT (Høsting av tresjiktet)","text":"Used Lauveng 2019 2020.marginal exclude already now.","code":"\ntemp <- dat2L[dat2L$NiN_variable_code == \"7JB-HT-ST\" | \n               dat2L$NiN_variable_code == \"7JB-HT-SL\" ,]\ntable(temp$kartleggingsår, temp$naturtype)\n#>       \n#>        Lauveng\n#>   2019      14\n#>   2020       6\nexclude <- c(exclude,\n             \"7JB-HT-SL\",\n             \"7JB-HT-ST\")"},{"path":"naturtype2.html","id":"ra-bh-and-7ra-sj-rask-suksesjon-i-boreal-hei-og-i-i-semi-naturlig-og-sterkt-endret-jordbruksmark-inkludert-våteng","chapter":"4 Nature types - Part 2","heading":"4.1.2.16 7RA-BH and 7RA-SJ (rask suksesjon i boreal hei og i i semi-naturlig og sterkt endret jordbruksmark inkludert våteng)","text":"Condition variables.\ncases 7RA-SJ value X. numeric 1-4, value X mistake think. can exclude (.e. allow NA’s).","code":""},{"path":"naturtype2.html","id":"sd-0-and-7sd--ns-natur--og-normalskogsdynamikk","chapter":"4 Nature types - Part 2","heading":"4.1.2.17 7SD-0 and 7SD- NS (Natur- og normalskogsdynamikk)","text":"7SD-NS 7SD-0 also used one nature type (forest), wooded localities Flommyr, myrkant og myrskogsmark. X therefore means relevant, can also exclude parameters dataset together.","code":"\nexclude <- c(exclude, \n             \"7SD-0\",     \n             \"7SD-NS\")"},{"path":"naturtype2.html","id":"tk-and-7se-kjørespor-slitasje","chapter":"4 Nature types - Part 2","heading":"4.1.2.18 7TK and 7SE (kjørespor & slitasje)","text":"7TK (kjørespor) 7SE (slitasje) allowed value X, happened rare occasions (24) anyhow. ’s fine treat NA’s.","code":""},{"path":"naturtype2.html","id":"vr-ri-reguleringsintensitet","chapter":"4 Nature types - Part 2","heading":"4.1.2.19 7VR-RI (Reguleringsintensitet)","text":"variable defined numeric 1-5. , however, quite cases X.explain , case, variable good indicator condition rather represents pressure/driver. OK treat NA’s.","code":"\ntemp <- dat2L[dat2L$ninbeskrivelsesvariabler == \"7VR-RI_X\",]\ntable(temp$kartleggingsår, temp$naturtype)\n#>       \n#>        Åpen flomfastmark\n#>   2019                96\n#>   2021                11"},{"path":"naturtype2.html","id":"lkms-and-mdirpr-variables","chapter":"4 Nature types - Part 2","heading":"4.1.2.20 LKMs and MdirPR-variables","text":"variables include LKM’s (lokal kompleks miljøvariabel) nonrelevant us . can also exclude PR- variables, NEAs variables (NiN).LKMKI\nKalk (lime)\nExclude\nKalk (lime)ExcludeLKMSP\nSlåttemarkspreg\nExclude\nSlåttemarkspregExcludePRAK\nAntall NiN-kartleggingsenheter\nUsed biodiversity assessment\nExclude\nAntall NiN-kartleggingsenheterUsed biodiversity assessmentExcludePRAM\nMenneskeskapte objekter\nRelated 5BY 5AB\nExclude (see 5BY 5AB)\nMenneskeskapte objekterRelated 5BY 5ABExclude (see 5BY 5AB)PRH\nperhaps mistake PRHA PRHT\nExclude\nperhaps mistake PRHA PRHTExcludePRHA\nHabitat spesifikke arter\nUsed biodiversity assessment\nExclude\nHabitat spesifikke arterUsed biodiversity assessmentExcludePRHT\nHøsting av tresjiktet\nInclude\nHøsting av tresjiktetIncludePRKA\nKalkindikatorer\nUsed biodiversity assessment\nExclude\nKalkindikatorerUsed biodiversity assessmentExcludePRKU\nKystlyngheias utviklingsfaser\nRelated 7JB-KU\nUsed biodiversity assessment\nExclude\nKystlyngheias utviklingsfaserRelated 7JB-KUUsed biodiversity assessmentExcludePRMY\nMyrstruktur\nUsed biodiversity assessment\nExclude\nMyrstrukturUsed biodiversity assessmentExcludePRRL-CR/DD/EN/NT/VU\nRed list categories\nUsed biodiversity assessment\nExclude\nRed list categoriesUsed biodiversity assessmentExcludePRSE-KA\nStrukturer, elementer og torvmarksformer (2018)\nSee PRSE-PA\nStrukturer, elementer og torvmarksformer (2018)See PRSE-PAPRSE-PA\nStrukturer, elementer og torvmarksformer\nUsed biodiversity assessment\nExclude\nStrukturer, elementer og torvmarksformerUsed biodiversity assessmentExcludePRSE-SH\nStrukturer, elementer og torvmarksformer (2018)\nSee PRSE-PA\nStrukturer, elementer og torvmarksformer (2018)See PRSE-PAPRSL\nSlitasje\nRlated 7SE\nInclude\nSlitasjeRlated 7SEIncludePRTK\nSpor av tunge kjøretøyer\nRelated 7TK\nInclude\nSpor av tunge kjøretøyerRelated 7TKIncludePRTO\nTorvuttak\nInclude\nTorvuttakIncludePRVS\nVariasjon vannsprutintensitet\nUsed biodiversity assessment\nExclude\nVariasjon vannsprutintensitetUsed biodiversity assessmentExclude","code":"\nexclude <- c(exclude,\n             \"LKMKI\",     \n          \"LKMSP\",\n          \"PRAK\",\n          \"PRAM\",\n          \"PRH\",\n          \"PRHA\",\n          \"PRKA\",\n          \"PRKU\",\n          \"PRMY\",\n          \"PRRL-DD\",   \"PRRL-VU\",   \"PRRL-NT\",   \"PRRL-EN\",   \"PRRL-CR\",  \n          \"PRSE-KA\",\n          \"PRSE-PA\",\n          \"PRSE-SH\",\n          \"PRVS\"\n          )"},{"path":"naturtype2.html","id":"subset","chapter":"4 Nature types - Part 2","heading":"4.1.3 Subset","text":"Now 20 possible condition variables.also now exclude nature types mapped 2018 /2019 . nature types get data future, also mapped time methodology quite unstable.","code":"\ndat2L2 <- dat2L[!is.na(dat2L$NiN_variable_value),]\ndat2L2 <- dat2L2[dat2L2$NiN_variable_code %!in% exclude,]\nlength(unique(dat2L2$NiN_variable_code))\n#> [1] 20\nntypDF2 <- ntypDF[ntypDF$Year != \"2018\" &\n                  ntypDF$Year != \"2019\" & \n                  ntypDF$Year != \"2018, 2019\"# no types were mappend in 2018 & 2019 only\n                  ,]"},{"path":"naturtype2.html","id":"fill-inn-ntypdf2","chapter":"4 Nature types - Part 2","heading":"4.1.4 Fill inn ntypDF2","text":"Next want expand ntypDF2 include NiN main types covered different nature types. use field data , many mistakes data. need look definition nature type get NiN code . also extract NiN sub types (grunntyper), become messy. Therefor create second column textual/categorical description degree themaic coverage.look definitions nature type first last year type mapped, years .","code":""},{"path":"naturtype2.html","id":"add-nin-main-type-and-degree-of-representativity","chapter":"4 Nature types - Part 2","heading":"4.1.4.1 Add NiN main type and degree of representativity","text":"Split new column two.","code":"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Aktiv skredmark\"                                    ] <- \"T17 | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Åpen flomfastmark\"                                  ] <- \"T18 | all\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Åpen grunnlendt kalkrik mark i boreonemoral sone\"   ] <- \"T2  | calcareous\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Åpen grunnlendt kalkrik mark i sørboreal sone\"      ] <- \"T2  | calcareous\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Atlantisk høymyr\"                                   ] <- \"V3  | all (if including sub-types)\" # can also include smaller areas of V1\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Boreal hei\"                                         ] <- \"T31 | all\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Eksentrisk høymyr\"                                  ] <- \"V3  | all (if including sub-types)\" # can also include smaller areas of V1\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Eng-aktig sterkt endret fastmark\"                   ] <- \"T41 | all\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Fosse-eng\"                                          ] <- \"T15 | all\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Fosseberg\"                                          ] <- \"T1  | extra wet\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Fossepåvirket berg\"                                 ] <- \"T1  | extra wet\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Fuglefjell-eng og fugletopp\"                        ] <- \"T8  | all\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Hagemark\"                                           ] <- \"T32 | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Høgereligende og nordlig nedbørsmyr\"                ] <- \"V3  | all (if including sub-types)\" # torvmarksformene are excluded\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Isinnfrysingsmark\"                                  ] <- \"T20 | all\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Kalkrik helofyttsump\"                               ] <- \"L4 | calcareous\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Kanthøymyr\"                                         ] <- \"V3  | all (if including sub-types)\" # can also include smaller areas of V1\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Konsentrisk høymyr\"                                 ] <- \"V3  | all (if including sub-types)\" # can also include smaller areas of V1\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Kystlynghei\"                                        ] <- \"T34 | all\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Lauveng\"                                            ] <- \"T32 | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Nakent tørkeutsatt kalkberg\"                        ] <- \"T1  | calcareous and dry\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Naturbeitemark\"                                     ] <- \"T32 | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Øvre sandstrand uten pionervegetasjon\"              ] <- \"T29 | sandy and vegetated\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Øyblandingsmyr\"                                     ] <- \"V1  | partial\" # also includes V3\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Palsmyr\"                                            ] <- \"V3  | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Platåhøymyr\"                                        ] <- \"V3  | all (if including sub-types)\" # can also include smaller areas of V1\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Rik åpen jordvannsmyr i mellomboreal sone\"          ] <- \"V1  | calcareous\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Rik åpen jordvannsmyr i nordboreal og lavalpin sone\"] <- \"V1  | calcareous\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Rik åpen sørlig jordvannsmyr\"                       ] <- \"V1  | calcareous\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Sanddynemark\"                                       ] <- \"T21 | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Semi-naturlig eng\"                                  ] <- \"T32 | all (if including sub-types)\"\n# This might be called Kulturmarkseng in the 2018 protocol, but Semi-naturlig eng in the data set. \n# Kulturmarkseng also includes V10\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Semi-naturlig myr\"                                  ] <- \"V9  | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Semi-naturlig strandeng\"                            ] <- \"T33 | all (-2018)\" # could perhaps be used in 2018, but it's defined awkwardly\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Semi-naturlig våteng\"                               ] <- \"V10 | all (-2018)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Silt og leirskred\"                                  ] <- \"T17 | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Slåttemark\"                                         ] <- \"T32 | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Slåttemyr\"                                          ] <- \"V9  | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Sørlig etablert sanddynemark\"                       ] <- \"T21 | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Sørlig kaldkilde\"                                   ] <- \"V4  | southern\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Sørlig nedbørsmyr\"                                  ] <- \"V3  | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Sørlig slåttemyr\"                                   ] <- \"V9  | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Strandeng\"                                          ] <- \"T12 | all (-2018)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Svært tørkeutsatt sørlig kalkberg\"                  ] <- \"T1  | calcareous and dry\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Terrengdekkende myr\"                                ] <- \"V3  | all (if including sub-types)\"\nntypDF2 <- ntypDF2 %>%\n  tidyr::separate(col = hovedgruppe,\n                  into = c(\"NiN_mainType\", \"NiN_mainTypeCoverage\"),\n                  #sep = \"|\",\n                  remove=T,\n                  extra = \"merge\"\n              )"},{"path":"naturtype2.html","id":"add-nin-variables","chapter":"4 Nature types - Part 2","heading":"4.1.4.2 Add NiN variables","text":"Add column total number localities nature type get percentage localities NiN recorded.Cast get NiN codes columnsThis data set contains nature types mapped 2018 2019, removed ntypDF2:remove also .Combine datasets","code":"\nntyp_vars <- as.data.frame(table(dat2L2$naturtype, dat2L2$NiN_variable_code))\nnames(ntyp_vars) <- c(\"Nature_type\", \"NiN_variable_code\", \"NiN_variable_count\")\nntyp_vars <- ntyp_vars[ntyp_vars$NiN_variable_count >0,]\nhead(ntyp_vars)\n#>                                          Nature_type\n#> 3   Åpen grunnlendt kalkrik mark i boreonemoral sone\n#> 16                                          Hagemark\n#> 28                                    Naturbeitemark\n#> 69                                          Hagemark\n#> 79                                           Lauveng\n#> 144                                Semi-naturlig myr\n#>     NiN_variable_code NiN_variable_count\n#> 3             1AG-A-0                 34\n#> 16            1AG-A-0                314\n#> 28            1AG-A-0                  1\n#> 69            1AG-A-E               1383\n#> 79            1AG-A-E                 10\n#> 144           1AG-A-G                690\n#options(scipen=999) # suppress exp notation\ncount <- as.data.frame(table(dat2$naturtype))\nnames(count) <- c(\"Nature_type\", \"totalLocations\")\nntyp_vars$totalLocations <- count$totalLocations[match(ntyp_vars$Nature_type, count$Nature_type)]\nntyp_vars$percentageUse <- round((ntyp_vars$NiN_variable_count/ntyp_vars$totalLocations)*100, 1)\n# should switch to pivot_wider\nntyp_vars_wide <- data.table::dcast(setDT(ntyp_vars),\n                                    Nature_type~NiN_variable_code,\n                                    value.var = \"percentageUse\")\nntyp_vars_wide$Nature_type[ntyp_vars_wide$Nature_type %!in% ntypDF2$Nature_type]\n#> [1] Åpen myrflate i boreonemoral til nordboreal sone            \n#> [2] Åpen myrflate i lavalpin sone                               \n#> [3] Flommyr, myrkant og myrskogsmark                            \n#> [4] Kaldkilde under skoggrensa                                  \n#> [5] Kalkrik åpen jordvannsmyr i boreonemoral til nordboreal sone\n#> [6] Kystnedbørsmyr                                              \n#> [7] Sentrisk høgmyr                                             \n#> [8] Sørlig strandeng                                            \n#> [9] Tørt kalkrikt berg i kontinentale områder                   \n#> 53 Levels: Aktiv skredmark ... Tørt kalkrikt berg i kontinentale områder\nntyp_vars_wide <- ntyp_vars_wide[ntyp_vars_wide$Nature_type %in% ntypDF2$Nature_type]\nntyp_fill <- cbind(ntypDF2, ntyp_vars_wide[,-1][match(ntypDF2$Nature_type, ntyp_vars_wide$Nature_type)])"},{"path":"naturtype2.html","id":"add-number-of-location-and-total-area-mapped","chapter":"4 Nature types - Part 2","heading":"4.1.4.3 Add number of location and total area mapped","text":"","code":"\ndat2$km2 <- units::drop_units(dat2$area/10^6)\n\nnum <- as.data.frame(dat2) %>%\n  group_by(naturtype)%>%\n  summarise(km2 = sum(km2),\n            numberOfLocalities = n())\n\nntyp_fill <- cbind(ntyp_fill, num[,-1][match(ntyp_fill$Nature_type, num$naturtype),])"},{"path":"naturtype2.html","id":"plots","chapter":"4 Nature types - Part 2","heading":"4.2 Plots","text":"\nFigure 4.2: total mapped area nature types associated three selected main ecosystems\n","code":"\n\nmySize <- 8\ngg_area <- ntyp_fill %>%\n  arrange(km2) %>%\n  mutate(Nature_type=factor(Nature_type, levels=Nature_type)) %>%   # This trick update the factor levels\n  ggplot( aes(x = Nature_type,\n                   y = km2)) +\n        geom_segment( aes(xend=Nature_type, yend=0)) +\n        geom_point( size=4, aes(group = Ecosystem,\n                                colour= Ecosystem)) +\n        coord_flip() +\n        theme_bw(base_size = mySize) +\n        xlab(\"\")+\n        ylab(expression(km^2))+\n      theme(legend.position = \"top\",\n        legend.key.size =  unit(.05, 'cm'),\n            legend.background = element_rect(fill = \"white\", color = \"black\")\n            )\n\ngg_locs <- ntyp_fill %>%\n  arrange(km2) %>%\n  mutate(Nature_type=factor(Nature_type, levels=Nature_type)) %>%    # also sorted after km2\n  ggplot( aes(x = Nature_type,\n                   y = numberOfLocalities)) +\n        geom_segment( aes(xend=Nature_type, yend=0)) +\n        geom_point( size=4, aes(group = Ecosystem,\n                                colour= Ecosystem)) +\n        coord_flip() +\n        theme_bw(base_size = mySize) +\n        xlab(\"\")+\n        ylab(\"Number of localities\")+\n  theme(legend.position = \"none\",\n        axis.text.y = element_blank())\n\n\negg::ggarrange(gg_area, gg_locs, \n                        ncol = 2)"},{"path":"naturtype2.html","id":"area-per-nin-main-type-conditioned-on-ecosystem-and-adding-empty-main-types","chapter":"4 Nature types - Part 2","heading":"4.2.1 Area per NiN main type conditioned on ecosystem and adding empty main types","text":"First add NiN main types covered nature types.Adding non-mapped open typesAdding non-mapped semi-natural typesAdding non-mapped wetland typesV6 Våtsnøleie, guess mapped, grouped alpine ecosystem. ’ll therefore add , mention figure caption .\nFigure 4.3: areas mapped NiN main type, degree spatial representativity (coverage) mapping units (nature types). V6 Våtsnøleie og snøleiekilde included.\nfigure take Naturlig åpne områder poorly represented general, many NiN main types completely missing dataset. three common types, however, complete thematic coverage (excluding year 2018 including sub-types). need investigate NiN variables nature types mapping T18 Åpen flomfastmark, T12 Strandeng T21 Sanddynemark can use.Semi-naturlig mark quite good thematic coverage three main types. three types probably makes considerably smaller area, note T33 coverage, classes (-2018). three main ecosystems, semi-naturlig mark dominates clearly. need look NiN variables associated mapping units main NiN types. can also possibly explore distribution mapped polygons environmental space compare AR5 reference, ’m sure good AR5 anything whihc cropland.Våtmark good thematic coverage V3 nedbørsmyr V9 semi-naturlig myr, V1 åpen jordvassmyr calcareous localities mapped assessed. question whether, given NiN variable, calcareous localities can representative mires (poor rich) intruduce much bias one way another.","code":"\nopen <- c(\n  \"T1\",\n  \"T2\",\n  \"T6\",\n  \"T8\",\n  \"T11\",\n  \"T12\",\n  \"T13\",\n  \"T15\",\n  \"T16\",\n  \"T17\",\n  \"T18\",\n  \"T20\",\n  \"T21\",\n  \"T23\",\n  \"T24\",\n  \"T25\",\n  \"T26\",\n  \"T27\",\n  \"T29\"\n)\n\nsemi <- c(\n  \"T31\",\n  \"T32\",\n  \"T33\",\n  \"T34\",\n  \"T40\",  # are these included\n  \"T41\"   # are these included\n)\n\nwetland <- c(\n  \"V1\",\n  \"V3\",\n  \"V4\",\n  \"V6\",\n  \"V9\",\n  \"V10\",\n  \"L4\"    # this will probably not be part of the assessments\n  \n)\nopen[open %!in% ntyp_fill$NiN_mainType]\n#> [1] \"T6\"  \"T11\" \"T13\" \"T16\" \"T23\" \"T24\" \"T25\" \"T26\" \"T27\"\nntyp_fill2 <- ntyp_fill %>%\n  add_row(NiN_mainType = \"T6\", Ecosystem = \"Naturlig åpne områder under skoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) %>%\n  add_row(NiN_mainType = \"T11\", Ecosystem = \"Naturlig åpne områder under skoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) %>%\n  add_row(NiN_mainType = \"T13\", Ecosystem = \"Naturlig åpne områder under skoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) %>%\n  add_row(NiN_mainType = \"T16\", Ecosystem = \"Naturlig åpne områder under skoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) %>%\n  add_row(NiN_mainType = \"T23\", Ecosystem = \"Naturlig åpne områder under skoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) %>%\n  add_row(NiN_mainType = \"T24\", Ecosystem = \"Naturlig åpne områder under skoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) %>%\n  add_row(NiN_mainType = \"T25\", Ecosystem = \"Naturlig åpne områder under skoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) %>%\n  add_row(NiN_mainType = \"T26\", Ecosystem = \"Naturlig åpne områder under skoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) %>%\n  add_row(NiN_mainType = \"T27\", Ecosystem = \"Naturlig åpne områder under skoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) \nsemi[semi %!in% ntyp_fill$NiN_mainType]\n#> [1] \"T40\"\nntyp_fill2 <- ntyp_fill %>%\n  add_row(NiN_mainType = \"T40\", Ecosystem = \"Semi-naturlig mark\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0)\nwetland[wetland %!in% ntyp_fill$NiN_mainType]\n#> [1] \"V6\"\nmySize <- 10\nntyp_fill2 %>%\n  # combining two classes to get a better colour palette\n  mutate(NiN_mainTypeCoverage = \n           replace(NiN_mainTypeCoverage, NiN_mainTypeCoverage == \"southern\", \"partial\"),\n         NiN_mainTypeCoverage = \n           replace(NiN_mainTypeCoverage, NiN_mainTypeCoverage == \"calcareous and dry\", \"calcareous\")) %>%\n  \n  group_by(NiN_mainType, NiN_mainTypeCoverage) %>%\n  mutate(km2 = sum(km2)) %>%\n  slice_head()%>%\n  select(Ecosystem,\n         NiN_mainType,\n         NiN_mainTypeCoverage,\n         km2)%>%\n  ungroup() %>%\n  mutate(NiN_mainType = fct_reorder(NiN_mainType, km2)) %>%\n  ggplot(aes(x = NiN_mainType,\n             y = km2,\n             fill = NiN_mainTypeCoverage))+\n    geom_bar(stat = \"identity\",\n             colour = \"grey40\",\n             position = \"stack\")+\n    theme_bw(base_size = mySize)+\n    coord_flip()+\n  labs(x = \"NiN main type\",\n       y = expression(km^2),\n       fill = \"Spatial coverage\")+\n  scale_fill_brewer(palette = \"Set1\")+\n  facet_wrap(vars(Ecosystem),\n             scales = \"free\",\n             labeller = label_wrap_gen(width=25))"},{"path":"naturtype2.html","id":"for-each-nin-main-type-the-proportion-mapped-with-each-nin-variable","chapter":"4 Nature types - Part 2","heading":"4.2.2 For each NiN main type, the proportion mapped with each NiN variable","text":"\nFigure 4.4: Barplot showing proportion area NiN variable recorded. total mapped area main ecosystem (facets) shown dashed red line. three dominant NiN main types ecosystem given uniqe colour, remaining grouped ‘.’\n","code":"\nareaSum <- ntyp_fill2 %>%\n  group_by(Ecosystem) %>%\n  summarise(km2 = sum(km2)) %>%\n  tibble::add_column(.before=1,\n                     NiN_code = rep(\"Combined\", 3))\nntyp_fill2 %>%\n  pivot_longer(cols = unique(ntyp_vars$NiN_variable_code)) %>%\n  drop_na(value) %>%\n  rename(NiN_code = name,\n         useFrequency = value) %>%\n  filter(useFrequency > 0) %>%\n  group_by(NiN_code, Ecosystem, NiN_mainType) %>%  # NiN main type could be replaced with Nature_type\n  summarise(km2 = sum(km2)) %>%\n  \n  # create a truncated fill variable \n  group_by(Ecosystem) %>%\n  mutate(myFill = fct_lump(NiN_mainType, 3, w = km2)) %>%\n  \n  # qick fix to sort variable across facets (dont work after adding 'Nature_type' in the first group_by)\n  #mutate(lab = paste(NiN_code, substr(Ecosystem, start = 1, stop = 1), sep = \" \")) %>%\n  #ungroup()%>%\n  #mutate(lab = forcats::fct_reorder(lab, km2)) %>%\n  \n  \n  # plot\n  ggplot(aes(x = NiN_code,\n              y = km2,\n             fill = myFill\n                ))+\n  geom_bar(stat = \"identity\",\n           colour = \"grey40\",\n           #fill = \"grey80\",\n           position = \"stack\")+\n  geom_hline(data = areaSum,\n             aes(yintercept = km2),\n             colour = \"red\",\n             linetype = \"dashed\")+\n  facet_wrap(vars(Ecosystem),\n             scales = \"free\",\n             labeller = label_wrap_gen(width=25))+\n  labs(x = \"\",\n       y = expression(km^2),\n       fill = \"\")+\n  coord_flip()+\n  scale_fill_brewer(palette = \"Set1\")+\n  theme_bw(base_size = mySize)\n#> `summarise()` has grouped output by 'NiN_code', 'Ecosystem'. You can override using the `.groups` argument.\n#> Warning in RColorBrewer::brewer.pal(n, pal): n too large, allowed maximum for palette Set1 is 9\n#> Returning the palette you asked for with that many colors"},{"path":"naturtype2.html","id":"tentative-conclusions-and-the-way-forward","chapter":"4 Nature types - Part 2","heading":"4.3 Tentative conclusions and the way forward","text":"figure, combination , points obvious NiN variable candidates.7SE 7TK good candidates Naturlig åpne områder. 7JA-BT probably appropriately classed pressure indicator. 7VR-RI recorded T18 localities.\n7FA potentially issue related NiN-app build doesn’t allow registering alien species fremmedartsliste.two variables (7SE 7TK) best candidates also Semi-natural areas. 7JB-BT pressure variable (beitetrykk). 7RA-SJ/BH related gjengoing covered another indicator informed remote sensing (LiDAR), therefor don’t need describe field-based indicator well.Våtmark, 7GR-Gi common variables, pressure variable (grøfting). , perhaps used surrogate indicator. think justifiable, especially since relationship pressure (grøfting) condition (hydrology) well known. 7SE 7TK+PRTK candidates. PRTO relevant V3, covers relatively large area.Next, focus Våtmark-variables, since can use new ecosystem delineation map reference evaluate environamlental spatial bias dataset. currently possible two ecosystems.","code":""},{"path":"naturtype2.html","id":"tables","chapter":"4 Nature types - Part 2","heading":"4.4 Tables","text":"output tables numbers numbers underlying figures.\nFigure 4.5: List 45 nature types additionam data, including proportion localities data NiN variables.\n\nFigure 4.6: List unique combinatios NiN variable codes naturetypes summed area data.\n","code":"\nDT::datatable(ntyp_fill2,\n              #extensions = \"FixedColumns\",\n  options = list(\n    scrollX = T,\n    scrollY=T,\n    pageLength = 10))\nDT::datatable(\n  ntyp_fill2 %>%\n  pivot_longer(cols = unique(ntyp_vars$NiN_variable_code)) %>%\n  drop_na(value) %>%\n  rename(NiN_code = name,\n         useFrequency = value) %>%\n  filter(useFrequency > 0) %>%\n  group_by(NiN_code, Ecosystem, NiN_mainType) %>%  # NiN main type could be replaced with Nature_type\n  summarise(km2 = sum(km2)),\n  options = list(\n    scrollX = T,\n    scrollY=T,\n    pageLength = 10))\n#> `summarise()` has grouped output by 'NiN_code', 'Ecosystem'. You can override using the `.groups` argument."},{"path":"scaling-functions.html","id":"scaling-functions","chapter":"5 Scaling functions","heading":"5 Scaling functions","text":"Author. Anders L. KolstadDate: 2022-10-11Indicator ecological condition may scaled reference value become normalised hence comparable. SEEA EA, un-scaled raw indicators called indicators , simply referred variables, use distinction . Scaling variables reference conditions can done many ways. examples, inspiration.Define plotting aestheticsCreate random raw data two variablesLets say reference condition variable1 equal 16, variable 2 35","code":"\nset.seed(123)\nlow <- \"red\"\nhigh <- \"green\"\nridge <- geom_density_ridges_gradient(scale = 3, size = .3)\nmyColour <- \"black\"\nmySize <- 10\nmyAlpha <- .7\nmyShape <- 21\ndat <- data.frame(variable1 = rnorm(50, 10, 4), \n                  variable2 = rnorm(50, 30, 3))\n\ntemp <- data.table::melt(setDT(dat))\n#> Warning in melt.data.table(setDT(dat)): id.vars and\n#> measure.vars are internally guessed when both are 'NULL'.\n#> All non-numeric/integer/logical type columns are considered\n#> id.vars, which in this case are columns []. Consider\n#> providing at least one of 'id' or 'measure' vars in future.\n\nggplot(temp,\n       aes(x = value,\n           y = variable,\n           fill = stat(x)))+\n  ridge+\n  scale_fill_gradient(low = low, high = high)\n#> Picking joint bandwidth of 1.22\ndat$referenceHigh1 <- 16\ndat$referenceHigh2 <- 35"},{"path":"scaling-functions.html","id":"linear-with-a-natural-zero","chapter":"5 Scaling functions","heading":"5.1 Linear, with a natural zero","text":"can scale variable linearly, saying values 12 represents ‘perfect’ condition. also assume value zero worst possible condition variable. divide reference value, truncate values .reverse good bad condition: change sign add one.two indicators become comparable now normalised. least true around reference value. perhaps variable value around 25 variable2 actually quite bad. example assumed value zero worst possible value, may always case.","code":"\ndat$indicator1 <- dat$variable1/dat$referenceHigh1\ndat$indicator1[dat$indicator1>1] <- 1\n\ndat$indicator2 <- dat$variable2/dat$referenceHigh2\ndat$indicator2[dat$indicator2>1] <- 1\ntemp <- melt(setDT(dat),\n             measure.vars = c(\"indicator1\", \"indicator2\"))\nggplot(dat)+\n  geom_point(\n    aes(x = variable1, y = indicator1, fill = indicator1),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  geom_vline(xintercept = dat$referenceHigh1[1],\n             linetype = \"dashed\",\n             size =2)+\n  \n  geom_point(aes(x = variable2, y = indicator2, fill = indicator2),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  geom_vline(xintercept = dat$referenceHigh2,\n             linetype = \"dashed\",\n             size =2)+\n  ylab(\"Indicator values\")+\n  xlab(\"Variable values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)\nggplot(dat)+\n  geom_point(\n    aes(x = variable1, y = indicator1*(-1)+1, fill = indicator1*(-1)+1),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  geom_vline(xintercept = dat$referenceHigh1[1],\n             linetype = \"dashed\",\n             size =2)+\n  \n  ylab(\"Indicator values\")+\n  xlab(\"Variable values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)"},{"path":"scaling-functions.html","id":"linear-with-defined-lower-limit","chapter":"5 Scaling functions","heading":"5.2 Linear, with defined lower limit","text":"can also say worst possible condition variables zero, example say 5 variable1 28 variable2.can normalise data two reference values.","code":"\ndat$referenceLow1 <- 5\ndat$referenceLow2 <- 28\ndat$indicator1_LowHigh <- (dat$variable1-dat$referenceLow1)/(dat$referenceHigh1 - dat$referenceLow1)\ndat$indicator1_LowHigh[dat$indicator1_LowHigh <0] <- 0\ndat$indicator1_LowHigh[dat$indicator1_LowHigh >1] <- 1\n\ndat$indicator2_LowHigh <- (dat$variable2-dat$referenceLow2)/(dat$referenceHigh2 - dat$referenceLow2)\ndat$indicator2_LowHigh[dat$indicator2_LowHigh <0] <- 0\ndat$indicator2_LowHigh[dat$indicator2_LowHigh >1] <- 1\nggplot(dat)+\n  geom_point(\n    aes(x = variable1, y = indicator1_LowHigh, fill = indicator1_LowHigh),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  geom_vline(xintercept = 16,\n             linetype = \"dashed\",\n             size =2)+\n  geom_vline(xintercept = 5,\n             linetype = \"dashed\",\n             size =2)+\n  \n  geom_point(aes(x = variable2, y = indicator2_LowHigh, fill = indicator2_LowHigh),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  geom_vline(xintercept = 35,\n             linetype = \"dashed\",\n             size =2)+\n  geom_vline(xintercept = 28,\n             linetype = \"dashed\",\n             size =2)+\n  ylab(\"Indicator values\")+\n  xlab(\"Variable values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)"},{"path":"scaling-functions.html","id":"break-point-scaling","chapter":"5 Scaling functions","heading":"5.3 Break point scaling","text":"can also define threshold good ecological condition. Lets example say variable1, ecosystem function really declines variable shows values 9.can normalise , using refer break point normalisation. maths, see .solid lines point indicator value variable equals threshold value.","code":"\ndat$thr1 <- 9\ndat$indicator1_breakPoint <- ifelse(\n  dat$variable1 < dat$thr1,\n    ((dat$variable1-dat$referenceLow1)/(dat$thr1 - dat$referenceLow1))*(0.6-0)+0,\n    ((dat$variable1-dat$thr1)/(dat$referenceHigh1 - dat$thr1))*(1-0.6)+0.6\n  )\n\ndat$indicator1_breakPoint[dat$indicator1_breakPoint<0] <- 0\ndat$indicator1_breakPoint[dat$indicator1_breakPoint>1] <- 1\nggplot(dat)+\n  geom_point(\n    aes(x = variable1, y = indicator1_breakPoint, fill = indicator1_breakPoint),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  geom_vline(xintercept = dat$referenceHigh1[1],\n             linetype = \"dashed\",\n             size =2)+\n  geom_vline(xintercept = dat$referenceLow1,\n             linetype = \"dashed\",\n             size =2)+\n  geom_segment(aes(x = thr1, y = 0, xend = thr1, yend = 0.6),\n               linetype=\"solid\",\n               size=1.5)+\n  geom_segment(aes(x = 0, y = 0.6, xend = thr1, yend = 0.6),\n               linetype=\"solid\",\n               size=1.5)+\n  \n  ylab(\"Indicator values\")+\n  xlab(\"Variable values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)"},{"path":"scaling-functions.html","id":"two-sided-indicator","chapter":"5 Scaling functions","heading":"5.4 Two-sided indicator","text":"indicator may optimum value somewhere middle range, rather max min value. can define two-sided indicator.\nLets say variable2 optimal level 30, values either lower high bad.","code":"\ndat$referenceMid2 <- 30\ndat$indicator2_twoSided <- ifelse(\n  dat$variable2<dat$referenceMid2,\n    (dat$variable2-dat$referenceLow2)/(dat$referenceMid2-dat$referenceLow2),\n    ((dat$variable2-dat$referenceMid2)/(dat$referenceHigh2-dat$referenceMid2))*(-1)+1\n  )\n\n# truncating\ndat$indicator2_twoSided[dat$indicator2_twoSided<0] <- 0\ndat$indicator2_twoSided[dat$indicator2_twoSided>1] <- 1\nggplot(dat)+\n  geom_point(\n    aes(x = variable2, y = indicator2_twoSided, fill = indicator2_twoSided),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  geom_vline(xintercept = dat$referenceMid2[1],\n             linetype = \"dashed\",\n             size =2)+\n  geom_vline(xintercept = dat$referenceLow2[1],\n             linetype = \"dashed\",\n             size =2)+\n  geom_vline(xintercept = dat$referenceHigh2[1],\n             linetype = \"dashed\",\n             size =2)+\n \n  ylab(\"Indicator values\")+\n  xlab(\"Variable values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)"},{"path":"scaling-functions.html","id":"sigmoid-transformation","chapter":"5 Scaling functions","heading":"5.5 Sigmoid transformation","text":"many , non-linear ways normalise indicator. correct choice scaling function varies indicators depends nature indicator represents, also uncertainty around reference values. Personally, think sigmoid function often makes lot sense. less sensitive changes around min max reference values. slight deviation reference condition perhaps often described true reduction condition. true example reference communities (ecosystems defined , representing, good condition) show variation variable values, yet reference value fixed. linear scaling cases lead referred underestimation biaz (making thing look worse really ).equation sigmoid transformation use comes Oliver al. (2021); Eq. 1, Supplemetary Information S2.Finding transformed indicator value variable equals thresholdThe solid helperlines point indicator value variable value equals threshold. Later shift values indicator value becomes 0.6 point.Also plotted linearly normalised indicator values:dotted helper lines selve visual guides judge different scaled indicator value 0.6 two approaches.","code":"\ndat$indicator1_sigmoid <- 100.68*(1-exp(-5*(dat$indicator1_LowHigh)^2.5))/100\nsigmoid_thr <- 100.68*(1-exp(-5*((dat$thr1[1]-dat$referenceLow1[1])/(dat$referenceHigh1[1]-dat$referenceLow1[1]))^2.5))/100\nggplot(dat)+\n  geom_point(\n    aes(x = variable1, y = indicator1_sigmoid, fill = indicator1_sigmoid),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  \n  geom_vline(xintercept = dat$referenceLow1[1],\n             linetype = \"dashed\",\n             size =2)+\n  geom_vline(xintercept = dat$referenceHigh1[1],\n             linetype = \"dashed\",\n             size =2)+\n  \n  geom_segment(aes(x = thr1, y = 0, xend = thr1, yend = sigmoid_thr),\n               linetype=\"solid\",\n               size=1)+\n  geom_segment(aes(x = 0, y = sigmoid_thr, xend = thr1, yend = sigmoid_thr),\n               linetype=\"solid\",\n               size=1)+\n  \n  \n  ylab(\"Indicator values\")+\n  xlab(\"Variable values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)\nggplot(dat)+\n  geom_point(\n    aes(x = indicator1_LowHigh, y = indicator1_sigmoid, fill = indicator1_sigmoid),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  \n  geom_vline(xintercept = 0.6,\n             linetype = \"dashed\",\n             size =2)+\n   geom_hline(yintercept = 0.6,\n             linetype = \"dashed\",\n             size =2)+\n  \n  ylab(\"Sigmoid-transformed\\nIndicator values\")+\n  xlab(\"Linear indicatior values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)"},{"path":"scaling-functions.html","id":"accounting-for-the-threshold-value","chapter":"5 Scaling functions","heading":"5.5.1 Accounting for the threshold value","text":"can account threshold good ecological condition applying sigmoid transformation like thisThe grey circles horizonal line correspons sigmoid transformation without adjustment threshold value.","code":"\ndat$indicator1_sigmoid_thr <- ifelse(\n  dat$variable1<dat$thr1,\n    ((dat$indicator1_sigmoid-0)/(sigmoid_thr-0))*(0.6-0)+0,\n    ((dat$indicator1_sigmoid-sigmoid_thr)/(1-sigmoid_thr))*(1-0.6)+0.6\n  )\nggplot(dat)+\n  geom_point(\n    aes(x = variable1, y = indicator1_sigmoid),\n             fill   = \"grey\", \n             colour = myColour,\n             size   = 5,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  \n  geom_point(\n    aes(x = variable1, y = indicator1_sigmoid_thr, fill = indicator1_sigmoid_thr),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  \n  geom_vline(xintercept = dat$referenceLow1[1],\n             linetype = \"dashed\",\n             size =1)+\n  geom_vline(xintercept = dat$referenceHigh1[1],\n             linetype = \"dashed\",\n             size =1)+\n  \n  geom_segment(aes(x = 0, y = sigmoid_thr, xend = thr1, yend = sigmoid_thr),\n               linetype=\"solid\",\n               colour = \"grey\",\n               size=1)+\n  \n  geom_segment(aes(x = thr1, y = 0, xend = thr1, yend = 0.6),\n               linetype=\"solid\",\n               size=1)+\n  geom_segment(aes(x = 0, y = 0.6, xend = thr1, yend = 0.6),\n               linetype=\"solid\",\n               size=1)+\n  \n  \n  ylab(\"Indicator values\")+\n  xlab(\"Variable values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)"},{"path":"scaling-functions.html","id":"exponential-functoins","chapter":"5 Scaling functions","heading":"5.6 Exponential functoins","text":"two examples exponential transformation can also used:","code":"\ndat$indicator1_expConvex <- dat$indicator1_LowHigh^0.5\ndat$indicator1_expConcave <- dat$indicator1_LowHigh^2\n\nggplot(dat)+\n  geom_point(\n    aes(x = variable1, y = indicator1_expConvex, fill = indicator1_expConvex),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  geom_point(\n    aes(x = variable1, y = indicator1_expConcave, fill = indicator1_expConcave),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  \n  geom_vline(xintercept = dat$referenceLow1[1],\n             linetype = \"dashed\",\n             size =1)+\n  geom_vline(xintercept = dat$referenceHigh1[1],\n             linetype = \"dashed\",\n             size =1)+\n  ylab(\"Indicator values\")+\n  xlab(\"Variable values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)"}]
